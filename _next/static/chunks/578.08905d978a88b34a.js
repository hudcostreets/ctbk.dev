"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{79578:function(e,t,n){n.r(t),n.d(t,{MapBody:function(){return D},default:function(){return V}});var r,l,o,a=n(11527),u=n(50959),i=n(16244),c=n.n(i);function s(e,t){return Object.freeze({...e,...t})}let f=(0,u.createContext)(null),p=f.Provider;function d(){let e=(0,u.useContext)(f);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function m(){return d().map}function h(e){let t=m();return(0,u.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}var v=n(3852),y=n(10422);let g=["mapPane","markerPane","overlayPane","popupPane","shadowPane","tilePane","tooltipPane"];function E(e,t){let{[t]:n,...r}=e;return r}let b=(0,u.forwardRef)(function(e,t){let[n]=(0,u.useState)(e.name),[r,l]=(0,u.useState)(null);(0,u.useImperativeHandle)(t,()=>r,[r]);let o=d(),a=(0,u.useMemo)(()=>({...o,pane:n}),[o]);return(0,u.useEffect)(()=>(l(function(e,t,n){if(-1!==g.indexOf(e))throw Error(`You must use a unique name for a pane that is not a default Leaflet pane: ${e}`);if(null!=n.map.getPane(e))throw Error(`A pane with this name already exists: ${e}`);let r=t.pane??n.pane,l=r?n.map.getPane(r):void 0,o=n.map.createPane(e,l);return null!=t.className&&function(e,t){t.split(" ").filter(Boolean).forEach(t=>{v.DomUtil.addClass(e,t)})}(o,t.className),null!=t.style&&Object.keys(t.style).forEach(e=>{o.style[e]=t.style[e]}),o}(n,e,o)),function(){let e=o.map.getPane(n);e?.remove?.(),null!=o.map._panes&&(o.map._panes=E(o.map._panes,n),o.map._paneRenderers=E(o.map._paneRenderers,n))}),[]),null!=e.children&&null!=r?(0,y.createPortal)(u.createElement(p,{value:a},e.children),r):null});function x(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function w(e,t){return null==t?function(t,n){let r=(0,u.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let l=(0,u.useRef)();l.current||(l.current=e(n,r));let o=(0,u.useRef)(n),{instance:a}=l.current;return(0,u.useEffect)(function(){o.current!==n&&(t(a,n,o.current),o.current=n)},[a,n,r]),l}}function C(e,t){let n=(0,u.useRef)(t);(0,u.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function _(e,t){let n=(0,u.useRef)();(0,u.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function j(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function P(e,t){(0,u.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function k(e,t){var n,r;return n=w(e,t),r=function(e){let t=d(),r=n(j(e,t),t);return _(r.current,e.eventHandlers),P(r.current,t),function(e,t){let n=(0,u.useRef)();(0,u.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(r.current,e),r},(0,u.forwardRef)(function(e,t){let{instance:n,context:l}=r(e).current;return(0,u.useImperativeHandle)(t,()=>n),null==e.children?null:u.createElement(p,{value:l},e.children)})}function L(e,t){var n,r;return n=w(e,t),r=function(e){let t=d(),r=n(j(e,t),t);return C(t.map,e.attribution),_(r.current,e.eventHandlers),P(r.current,t),r},(0,u.forwardRef)(function(e,t){let{instance:n}=r(e).current;return(0,u.useImperativeHandle)(t,()=>n),null})}let M=k(function({positions:e,...t},n){let r=new v.Polyline(e,t);return x(r,s(n,{overlayContainer:r}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),O=(r=w(function(e,t){return x(new v.Tooltip(e,t.overlayContainer),t)}),l=function(e,t,{position:n},r){(0,u.useEffect)(function(){let l=t.overlayContainer;if(null==l)return;let{instance:o}=e,a=e=>{e.tooltip===o&&(null!=n&&o.setLatLng(n),o.update(),r(!0))},u=e=>{e.tooltip===o&&r(!1)};return l.on({tooltipopen:a,tooltipclose:u}),l.bindTooltip(o),function(){l.off({tooltipopen:a,tooltipclose:u}),null!=l._map&&l.unbindTooltip()}},[e,t,r,n])},o=function(e,t){let n=d(),o=r(j(e,n),n);return C(n.map,e.attribution),_(o.current,e.eventHandlers),l(o.current,n,e,t),o},(0,u.forwardRef)(function(e,t){let[n,r]=(0,u.useState)(!1),{instance:l}=o(e,r).current;(0,u.useImperativeHandle)(t,()=>l),(0,u.useEffect)(function(){n&&l.update()},[l,n,e.children]);let a=l._contentNode;return a?(0,y.createPortal)(e.children,a):null}));function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let T=(0,u.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:l,id:o,placeholder:a,style:i,whenReady:c,zoom:s,...f},d){let[m]=(0,u.useState)({className:l,id:o,style:i}),[h,y]=(0,u.useState)(null);(0,u.useImperativeHandle)(d,()=>h?.map??null,[h]);let g=(0,u.useCallback)(r=>{if(null!==r&&null===h){let l=new v.Map(r,f);null!=n&&null!=s?l.setView(n,s):null!=e&&l.fitBounds(e,t),null!=c&&l.whenReady(c),y(Object.freeze({__version:1,map:l}))}},[]);(0,u.useEffect)(()=>()=>{h?.map.remove()},[h]);let E=h?u.createElement(p,{value:h},r):a??null;return u.createElement("div",R({},m,{ref:g}),E)});function N({setCenter:e,setZoom:t,onClick:n,children:r}){let l=m();return h({click:e=>{console.log("leaflet click:",e),n&&n(e)},moveend:()=>e(l.getCenter()),zoom:()=>t(l.getZoom())}),u.createElement(u.Fragment,null,r)}function H(e,t,n){let{opacity:r,zIndex:l}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=l&&l!==n.zIndex&&e.setZIndex(l)}let S=L(function({url:e,...t},n){return x(new v.TileLayer(e,j(t,n)),n)},function(e,t,n){H(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}),z={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}},I=L(function({url:e,...t},n){return x(new v.TileLayer(e,j(t,n)),n)},function(e,t,n){H(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)});function q({map:e="alidade_smooth_dark",edgeBufferTiles:t,...n}){let{url:r,attribution:l}=z[e];return t?u.createElement(I,{url:r,attribution:l,...n}):u.createElement(S,{url:r,attribution:l,...n})}function A({map:e="alidade_smooth_dark",edgeBufferTiles:t,setCenter:n,setZoom:r,tolerance:l=12,padding:o=.5,onClick:a,children:i,...c}){let s=(0,u.useMemo)(()=>v.canvas({tolerance:l,padding:o}),[l,o]);return u.createElement(T,{...c,renderer:s},u.createElement(N,{setCenter:n,setZoom:r,onClick:a},u.createElement(q,{map:e,edgeBufferTiles:t}),i))}var B=n(37253);let Z=k(function({center:e,children:t,...n},r){let l=new v.Circle(e,n);return x(l,s(r,{overlayContainer:l}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)}),{sqrt:U}=Math;function F(e){let{id:t,count:n,selected:r,selectedStationId:l,setSelectedStationId:o,stations:u}=e;if(!(t in u))return console.log("id ".concat(t," not in stations")),null;let{name:i,lat:s,lng:f}=u[t];return(0,a.jsx)(Z,{center:{lat:s,lng:f},color:r?"yellow":"orange",radius:U(n),eventHandlers:{click:()=>{t!=l&&(console.log("click:",i),o(t))},mouseover:()=>{t!=l&&(console.log("over:",i),o(t))},mousedown:()=>{t!=l&&(console.log("down:",i),o(t))}},children:(0,a.jsx)(O,{className:c().tooltip,sticky:!0,permanent:t==l,pane:"selected",children:(0,a.jsxs)("p",{children:[i,": ",n]})})},t)}let{sqrt:$}=Math;function D(e){let{stations:t,selectedStationId:n,setSelectedStationId:r,stationPairCounts:l}=e,o=m(),i=o.getZoom(),s=(0,u.useMemo)(()=>(function(e){let t=e.getCenter(),n=e.latLngToContainerPoint(t),r=[n.x+1,n.y],l=e.containerPointToLatLng(n),o=e.containerPointToLatLng(r);return l.distanceTo(o)})(o),[o,i]);h({click:()=>{r(void 0)}});let f=(0,u.useMemo)(()=>n?t[n]:void 0,[t,n]),p=(0,u.useMemo)(()=>{if(!f||!n||!l)return null;if(!(n in l))return console.log("".concat(n," not found among ").concat((0,B.XP)(l).length," stations")),null;let e=l[n],r=Math.max(...Array.from(Object.values(e)));return(0,a.jsx)(b,{name:"lines",className:c().lines,children:(0,B.qh)(e).map(e=>{let[l,o]=e;if(!(l in t)){console.log("id ".concat(l," not in stations:"),t);return}let{name:u,lat:c,lng:p}=t[l];return(0,a.jsx)(M,{color:"red",positions:[[f.lat,f.lng],[c,p]],weight:Math.max(.7,o/r*$(f.starts)/s),opacity:.7,children:(0,a.jsxs)(O,{sticky:!0,children:[f.name," â†’ ",u,": ",o]})},"".concat(n,"-").concat(l,"-").concat(i))})})},[l,n,s]),d={stations:t,selectedStationId:n,setSelectedStationId:r};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b,{name:"selected",className:c().selected,children:n&&f&&(0,a.jsx)(F,{id:n,count:f.starts,selected:!0,...d},n)}),p,(0,a.jsx)(b,{name:"circles",className:c().circles,children:(0,B.qh)(t).map(e=>{let[t,n]=e;return(0,a.jsx)(F,{id:t,count:n.starts,...d},t)})})]})}function V(e){let{mapProps:t,bodyProps:n}=e;return(0,a.jsx)(A,{...t,children:(0,a.jsx)(D,{...n})})}}}]);