(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{97434:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stations",function(){return n(94278)}])},94278:function(t,e,n){"use strict";n.r(e),n.d(e,{MAPS:function(){return v},__N_SSG:function(){return b},default:function(){return k},ymParam:function(){return w}});var o=n(85893),s=n(79853),a=n(5152),i=n.n(a);let r=i()(()=>Promise.all([n.e(269),n.e(708)]).then(n.bind(n,25708)),{loadableGenerated:{webpack:()=>[25708]},ssr:!1});var c=n(33092),l=n(67294),u=n(24232),d=n.n(u),m=n(83300),p=n.n(m),h=n(96486),f=n.n(h);let g={lat:40.758,lng:-73.965},{entries:_,fromEntries:x,keys:j}=Object,{sqrt:y}=Math;var b=!0;let v={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}};function w(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=/^20(\d{4})$/,o=/^\d{4}$/;return{encode:e=>{if(e==t)return;let o=e.match(n);if(o)return o[1];console.warn("Invalid ym param: ".concat(e))},decode:e=>{if(!e)return t;let n=e.match(o);return n?"20".concat(e):(console.warn("Invalid ym param value: ".concat(e)),t)},push:e}}function k(t){let{defaults:e}=t,n={ll:(0,c.GS)({init:g,places:3}),z:(0,c.yc)(12,!1),ss:(0,c.ON)(),ym:w(e.ym)},{ll:[{lat:a,lng:i},u],z:[m,h],ss:[b,k],ym:[M,N]}=(0,c.O5)({params:n}),[S,P]=(0,l.useState)(e.stations),[z,C]=(0,l.useState)(null),{ymString:O}=(0,l.useMemo)(()=>{let t;let n=parseInt(M.substring(0,4)),o=parseInt(M.substring(4)),s=new Date(n,o-1).toLocaleDateString("default",{month:"short",year:"numeric"}),a="https://ctbk.s3.amazonaws.com/aggregated/".concat(M),i="".concat(a,"/se_c.json"),r="".concat(a,"/stations.json");return M==e.ym?(P(e.stations),console.log("Setting stations to default"),t=Promise.resolve(e.stations)):(console.log("fetching ".concat(r)),t=p()(r).then(t=>t.json()).then(t=>(console.log("got ".concat(_(t).length," stations")),P(t),t))),console.log("fetching ".concat(i)),Promise.all([t,p()(i).then(t=>t.json())]).then(t=>{let[e,n]=t,o=x(j(e).map((t,e)=>[e,t])),s=x(_(n).map(t=>{let[e,n]=t;return[o[e],f().mapKeys(n,(t,e)=>o[e])]}));console.log("got stationPairCounts (".concat(_(s).length," stations)")),C(s)}),{ymString:s}},[M]),T="Citi Bike rides by station, ".concat(O),{url:L,attribution:q}=v.alidade_smooth_dark;return(0,o.jsxs)("div",{className:d().container,children:[(0,o.jsx)(s.Z,{title:T,description:"Map of Citi Bike stations, including ridership counts and frequent destinations",path:"stations",thumbnail:"ctbk-stations"}),(0,o.jsxs)("main",{className:d().main,children:[(0,o.jsx)(r,{className:d().homeMap,center:{lat:a,lng:i},zoom:m,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,children:t=>(0,o.jsx)("div",{children:function(t,e){let{TileLayer:n,Marker:s,Circle:a,CircleMarker:i,Polyline:r,Pane:c,Tooltip:u,useMapEvents:m,useMap:p}=t,{setLL:h,setZoom:f,stations:g,selectedStationId:x,setSelectedStationId:b,stationPairCounts:v,url:w,attribution:k}=e,M=p(),N=M.getZoom(),S=(0,l.useMemo)(()=>(function(t){let e=t.getCenter(),n=t.latLngToContainerPoint(e),o=[n.x+1,n.y],s=t.containerPointToLatLng(n),a=t.containerPointToLatLng(o),i=s.distanceTo(a);return i})(M),[M,N]);m({moveend:()=>h(M.getCenter()),zoom:()=>f(M.getZoom()),click:()=>{b(void 0)}});let P=(0,l.useMemo)(()=>x?g[x]:void 0,[g,x]),z=(0,l.useMemo)(()=>{if(!P||!x||!v)return null;if(!(x in v))return console.log("".concat(x," not found among ").concat(j(v).length," stations")),null;let t=v[x],e=Array.from(Object.values(t)),n=Math.max(...e);return(0,o.jsx)(c,{name:"lines",className:d().lines,children:_(t).map(t=>{let[e,s]=t;if(!(e in g)){console.log("id ".concat(e," not in stations:"),g);return}let{name:a,lat:i,lng:c}=g[e];return(0,o.jsx)(r,{color:"red",positions:[[P.lat,P.lng],[i,c]],weight:Math.max(.7,s/n*y(P.starts)/S),opacity:.7,children:(0,o.jsxs)(u,{sticky:!0,children:[P.name," â†’ ",a,": ",s]})},"".concat(x,"-").concat(e,"-").concat(N))})})},[v,x,S]);function C(t){let{id:e,count:n,selected:s}=t;if(!(e in g))return console.log("id ".concat(e," not in stations")),null;let{name:i,lat:r,lng:c}=g[e];return(0,o.jsx)(a,{center:{lat:r,lng:c},color:s?"yellow":"orange",radius:y(n),eventHandlers:{click:()=>{e!=x&&(console.log("click:",i),b(e))},mouseover:()=>{e!=x&&(console.log("over:",i),b(e))},mousedown:()=>{e!=x&&(console.log("down:",i),b(e))}},children:(0,o.jsx)(u,{className:d().tooltip,sticky:!0,permanent:e==x,pane:"selected",children:(0,o.jsxs)("p",{children:[i,": ",n]})})},e)}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c,{name:"selected",className:d().selected,children:x&&P&&(0,o.jsx)(C,{id:x,count:P.starts,selected:!0},x)}),z,(0,o.jsx)(c,{name:"circles",className:d().circles,children:_(g).map(t=>{let[e,n]=t;return(0,o.jsx)(C,{id:e,count:n.starts},e)})}),(0,o.jsx)(n,{url:w,attribution:k})]})}(t,{setLL:u,setZoom:h,stations:S,selectedStationId:b,setSelectedStationId:k,stationPairCounts:z,url:L,attribution:q})})}),T&&(0,o.jsx)("div",{className:d().title,children:T})]})]})}},79853:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var o=n(85893);n(67294);var s=n(31606);let a="https://ctbk.dev",i="".concat(a,"/screenshots");function r(t){let{title:e,description:n,path:r,thumbnail:c}=t;return(0,o.jsxs)(s.F,{title:e,description:n,url:"".concat(a,"/").concat(r||""),thumbnail:"".concat(i,"/").concat(c,".png"),children:[(0,o.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,o.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,o.jsx)("meta",{property:"og:site_name",content:"ctbk.dev"},"ogsitename")]})}},24232:function(t){t.exports={container:"stations_container__Z0llF",main:"stations_main__xJuAQ",title:"stations_title__Lq0Hh",homeMap:"stations_homeMap__Ms8dh",selected:"stations_selected__AMT5f",circles:"stations_circles__T0Q2o",lines:"stations_lines__8OJmu",tooltip:"stations_tooltip__MQZ_e"}},83300:function(t,e){"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response}},function(t){t.O(0,[662,72,774,888,179],function(){return t(t.s=97434)}),_N_E=t.O()}]);