(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{53544:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/s3/[bucket]",function(){return e(96056)}])},96056:function(t,n,e){"use strict";e.r(n),e.d(n,{default:function(){return v}});var i=e(51438),o=e(51351),r=e(29815),c=e(85893),s=e(67294),a=e(98690),u=e.n(a),d=e(30381),h=e.n(d),l=e(89250),f=Math.ceil,g=Math.floor,x=Math.max,m=Math.min,p=function(){function t(n,e,o){(0,i.Z)(this,t),this.bucket=n,this.region=e,this.IdentityPoolId=o,this.pageSize=1e3,this.pagePromises=[],this.end=void 0,u().config.region=e,u().config.credentials=new(u().CognitoIdentityCredentials)({IdentityPoolId:o}),this.s3=new(u().S3)({})}var n=t.prototype;return n.get=function(t,n){var e,i=this.pageSize,o=g(t/i),c=f(n/i),s=Array.from(Array(c-o).keys()).map((function(t){return o+t})).map(this.getPage).map((function(e,r){return e.then((function(e){var c=o+r,s=c*i,a=x(t-s,0),u=m(n-s,i);if(!e.Contents)throw Error("Page ".concat(c," has no Contents: ").concat(e));return e.Contents.slice(a,u)}))}));return Promise.all(s).then((function(t){return(e=[]).concat.apply(e,(0,r.Z)(t))}))},n.getPage=function(t){var n=this,e=this.pagePromises;return t<e.length?e[t]:this.nextPage().then((function(){return n.getPage(t)}))},n.nextPage=function(){var t,n=this,e=this,i=e.bucket,o=e.s3,r=e.pageSize;if(!o)throw Error("S3 client not initialized");var c=this.pagePromises.length;t=c?this.pagePromises[c-1].then((function(t){var n;if(t.IsTruncated||!t.NextContinuationToken)throw new Error("Asked for next page (idx ".concat(c,") but page ").concat(c-1," is truncated ")+"(".concat(t.IsTruncated,", ").concat(t.NextContinuationToken,", ").concat(null===(n=t.Contents)||void 0===n?void 0:n.length," items)"));return t.NextContinuationToken})):Promise.resolve(void 0);var s=t.then((function(t){var e={Bucket:i,MaxKeys:r,Delimiter:"/",ContinuationToken:t};return console.log("Fetching page idx ".concat(c)),o.listObjectsV2(e).promise().then((function(t){var e,i=t.IsTruncated,o=null===(e=t.Contents)||void 0===e?void 0:e.length;return console.log("Got page idx ".concat(c," (").concat(o," items, truncated ").concat(i,", continuation ").concat(t.NextContinuationToken,")")),i||(n.end=c*r+(o||0),n.endCb&&n.endCb(n.end)),t}))}));return this.pagePromises.push(s),s},t}();function v(t){t=null!==t?t:(0,o.Z)(new TypeError("Cannot destructure undefined"));var n=(0,l.UO)(),e=n.bucket,i=n.key,r=e||"ctbk";console.log("Initializing, bucket ".concat(r," key ").concat(i));var a=(0,s.useMemo)((function(){return console.log("new fetcher for bucket ".concat(r)),new p(r,"us-east-1","us-east-1:9701c6f2-f84f-4c07-898f-bfe351e5d969")}),[r]),u=(0,s.useState)(0),d=u[0],f=(u[1],(0,s.useState)(null)),g=f[0],x=f[1];return(0,s.useEffect)((function(){a.getPage(0).then(x)}),[d,r]),g?(console.log("Rows:",g),(0,c.jsxs)("table",{children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Bucket"},"bucket"),(0,c.jsx)("th",{children:"Key"},"key"),(0,c.jsx)("th",{children:"Size"},"size"),(0,c.jsx)("th",{children:"Modified"},"mtime")]})}),(0,c.jsxs)("tbody",{children:[((null===g||void 0===g?void 0:g.CommonPrefixes)||[]).map((function(t){var n=t.Prefix;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:r},"bucket"),(0,c.jsx)("td",{children:n},"key"),(0,c.jsx)("td",{},"size"),(0,c.jsx)("td",{},"mtime")]},n)})),((null===g||void 0===g?void 0:g.Contents)||[]).map((function(t){var n=t.Key,e=t.Size,i=t.LastModified;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:r},"bucket"),(0,c.jsx)("td",{children:n},"key"),(0,c.jsx)("td",{children:e},"size"),(0,c.jsx)("td",{children:h()(i).format("YYYY-MM-DD")},"mtime")]},n)}))]})]})):(0,c.jsxs)("div",{children:["Fetching ",r,", page ",d,"\u2026"]})}},28022:function(){}},function(t){t.O(0,[885,586,236,774,888,179],(function(){return n=53544,t(t.s=n);var n}));var n=t.O();_N_E=n}]);