(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{69417:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/s3/[bucket]",function(){return n(10637)}])},10637:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return f}});var i=n(52676),s=n(75271),o=n(47377),c=n.n(o),r=n(11333),a=n.n(r),l=n(85491);let{ceil:h,floor:d,max:u,min:g}=Math;class x{get(t,e){let{pageSize:n}=this,i=d(t/n);return Promise.all(Array.from(Array(h(e/n)-i).keys()).map(t=>i+t).map(this.getPage).map((s,o)=>s.then(s=>{let c=i+o,r=c*n,a=u(t-r,0),l=g(e-r,n);if(!s.Contents)throw Error("Page ".concat(c," has no Contents: ").concat(s));return s.Contents.slice(a,l)}))).then(t=>[].concat(...t))}getPage(t){let{pagePromises:e}=this;return t<e.length?e[t]:this.nextPage().then(()=>this.getPage(t))}nextPage(){let{bucket:t,s3:e,pageSize:n}=this;if(!e)throw Error("S3 client not initialized");let i=this.pagePromises.length,s=(i?this.pagePromises[i-1].then(t=>{if(t.IsTruncated||!t.NextContinuationToken){var e;throw Error("Asked for next page (idx ".concat(i,") but page ").concat(i-1," is truncated ")+"(".concat(t.IsTruncated,", ").concat(t.NextContinuationToken,", ").concat(null===(e=t.Contents)||void 0===e?void 0:e.length," items)"))}return t.NextContinuationToken}):Promise.resolve(void 0)).then(s=>(console.log("Fetching page idx ".concat(i)),e.listObjectsV2({Bucket:t,MaxKeys:n,Delimiter:"/",ContinuationToken:s}).promise().then(t=>{var e;let s=t.IsTruncated,o=null===(e=t.Contents)||void 0===e?void 0:e.length;return console.log("Got page idx ".concat(i," (").concat(o," items, truncated ").concat(s,", continuation ").concat(t.NextContinuationToken,")")),!s&&(this.end=i*n+(o||0),this.endCb&&this.endCb(this.end)),t})));return this.pagePromises.push(s),s}constructor(t,e,n){this.bucket=t,this.region=e,this.IdentityPoolId=n,this.pageSize=1e3,this.pagePromises=[],this.end=void 0,c().config.region=e,c().config.credentials=new(c()).CognitoIdentityCredentials({IdentityPoolId:n}),this.s3=new(c()).S3({})}}function f(t){let{}=t,{bucket:e,key:n}=(0,l.UO)(),o=e||"ctbk";console.log("Initializing, bucket ".concat(o," key ").concat(n));let c=(0,s.useMemo)(()=>(console.log("new fetcher for bucket ".concat(o)),new x(o,"us-east-1","us-east-1:9701c6f2-f84f-4c07-898f-bfe351e5d969")),[o]),[r,h]=(0,s.useState)(0),[d,u]=(0,s.useState)(null);return((0,s.useEffect)(()=>{c.getPage(0).then(u)},[r,o]),d)?(console.log("Rows:",d),(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Bucket"},"bucket"),(0,i.jsx)("th",{children:"Key"},"key"),(0,i.jsx)("th",{children:"Size"},"size"),(0,i.jsx)("th",{children:"Modified"},"mtime")]})}),(0,i.jsxs)("tbody",{children:[((null==d?void 0:d.CommonPrefixes)||[]).map(t=>{let{Prefix:e}=t;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:o},"bucket"),(0,i.jsx)("td",{children:e},"key"),(0,i.jsx)("td",{},"size"),(0,i.jsx)("td",{},"mtime")]},e)}),((null==d?void 0:d.Contents)||[]).map(t=>{let{Key:e,Size:n,LastModified:s}=t;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:o},"bucket"),(0,i.jsx)("td",{children:e},"key"),(0,i.jsx)("td",{children:n},"size"),(0,i.jsx)("td",{children:a()(s).format("YYYY-MM-DD")},"mtime")]},e)})]})]})):(0,i.jsxs)("div",{children:["Fetching ",o,", page ",r,"â€¦"]})}},54881:function(){}},function(t){t.O(0,[883,195,977,214,501,888,774,179],function(){return t(t.s=69417)}),_N_E=t.O()}]);