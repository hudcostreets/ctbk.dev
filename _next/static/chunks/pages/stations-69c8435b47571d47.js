(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{97434:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stations",function(){return n(604)}])},90638:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(96856).Z;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var n=i.default,a=(null==e?void 0:e.suspense)?{}:{loading:function(t){t.error,t.isLoading;return t.pastDelay,null}};r(t,Promise)?a.loader=function(){return t}:"function"===typeof t?a.loader=t:"object"===typeof t&&(a=o({},a,t));!1;(a=o({},a,e)).suspense&&(delete a.ssr,delete a.loading);a.loadableGenerated&&delete(a=o({},a,a.loadableGenerated)).loadableGenerated;if("boolean"===typeof a.ssr&&!a.suspense){if(!a.ssr)return delete a.ssr,u(n,a);delete a.ssr}return n(a)},e.noSSR=u;var o=n(6495).Z,a=n(92648).Z,i=(a(n(67294)),a(n(14302)));function u(t,e){return delete e.webpack,delete e.modules,t(e)}("function"===typeof e.default||"object"===typeof e.default&&null!==e.default)&&"undefined"===typeof e.default.__esModule&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),t.exports=e.default)},16319:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableContext=void 0;var r=(0,n(92648).Z)(n(67294)).default.createContext(null);e.LoadableContext=r},14302:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(79658).Z,o=n(7222).Z;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(6495).Z,i=(0,n(92648).Z)(n(67294)),u=n(16319),c=n(67294).useSyncExternalStore,s=[],l=[],d=!1;function f(t){var e=t(),n={loading:!0,loaded:null,error:null};return n.promise=e.then((function(t){return n.loading=!1,n.loaded=t,t})).catch((function(t){throw n.loading=!1,n.error=t,t})),n}var p=function(){function t(e,n){r(this,t),this._loadFn=e,this._opts=n,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}return o(t,[{key:"promise",value:function(){return this._res.promise}},{key:"retry",value:function(){var t=this;this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};var e=this._res,n=this._opts;e.loading&&("number"===typeof n.delay&&(0===n.delay?this._state.pastDelay=!0:this._delay=setTimeout((function(){t._update({pastDelay:!0})}),n.delay)),"number"===typeof n.timeout&&(this._timeout=setTimeout((function(){t._update({timedOut:!0})}),n.timeout))),this._res.promise.then((function(){t._update({}),t._clearTimeouts()})).catch((function(e){t._update({}),t._clearTimeouts()})),this._update({})}},{key:"_update",value:function(t){this._state=a({},this._state,{error:this._res.error,loaded:this._res.loaded,loading:this._res.loading},t),this._callbacks.forEach((function(t){return t()}))}},{key:"_clearTimeouts",value:function(){clearTimeout(this._delay),clearTimeout(this._timeout)}},{key:"getCurrentValue",value:function(){return this._state}},{key:"subscribe",value:function(t){var e=this;return this._callbacks.add(t),function(){e._callbacks.delete(t)}}}]),t}();function m(t){return function(t,e){var n=function(){if(!s){var e=new p(t,o);s={getCurrentValue:e.getCurrentValue.bind(e),subscribe:e.subscribe.bind(e),retry:e.retry.bind(e),promise:e.promise.bind(e)}}return s.promise()},r=function(){n();var t=i.default.useContext(u.LoadableContext);t&&Array.isArray(o.modules)&&o.modules.forEach((function(e){t(e)}))},o=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null,suspense:!1},e);o.suspense&&(o.lazy=i.default.lazy(o.loader));var s=null;if(!d){var f=o.webpack?o.webpack():o.modules;f&&l.push((function(t){var e=!0,r=!1,o=void 0;try{for(var a,i=f[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var u=a.value;if(-1!==t.indexOf(u))return n()}}catch(c){r=!0,o=c}finally{try{e||null==i.return||i.return()}finally{if(r)throw o}}}))}var m=o.suspense?function(t,e){return r(),i.default.createElement(o.lazy,a({},t,{ref:e}))}:function(t,e){r();var n=c(s.subscribe,s.getCurrentValue,s.getCurrentValue);return i.default.useImperativeHandle(e,(function(){return{retry:s.retry}}),[]),i.default.useMemo((function(){return n.loading||n.error?i.default.createElement(o.loading,{isLoading:n.loading,pastDelay:n.pastDelay,timedOut:n.timedOut,error:n.error,retry:s.retry}):n.loaded?i.default.createElement((e=n.loaded)&&e.__esModule?e.default:e,t):null;var e}),[t,n])};return m.preload=function(){return n()},m.displayName="LoadableComponent",i.default.forwardRef(m)}(f,t)}function h(t,e){for(var n=[];t.length;){var r=t.pop();n.push(r(e))}return Promise.all(n).then((function(){if(t.length)return h(t,e)}))}m.preloadAll=function(){return new Promise((function(t,e){h(s).then(t,e)}))},m.preloadReady=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise((function(e){var n=function(){return d=!0,e()};h(l,t).then(n,n)}))},window.__NEXT_PRELOADREADY=m.preloadReady;var v=m;e.default=v},604:function(t,e,n){"use strict";n.r(e),n.d(e,{MAPS:function(){return S},__N_SSG:function(){return x},default:function(){return k},ymParam:function(){return O}});var r=n(828),o=n(29815),a=n(85893),i=n(9008),u=n.n(i),c=n(5152),s=n.n(c)()((function(){return Promise.all([n.e(269),n.e(685)]).then(n.bind(n,38685))}),{loadableGenerated:{webpack:function(){return[38685]}},ssr:!1}),l=n(61494);function d(t){var e=t.init,n=t.places;return{encode:function(t){var r=t.lat,o=t.lng;return r===e.lat&&o===e.lng?void 0:n?"".concat(r.toFixed(n),"_").concat(o.toFixed(n)):"".concat(r,"_").concat(o)},decode:function(t){if(!t)return e;var n=(0,r.Z)(t.split("_").map(parseFloat),2);return{lat:n[0],lng:n[1]}},push:t.push}}var f=n(67294),p=n(45553),m=n.n(p),h=n(83300),v=n.n(h),y=n(96486),g=n.n(y),_={lat:40.758,lng:-73.965},b=Object.entries,j=Object.fromEntries,w=Math.sqrt,x=!0,S={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}};function Z(t,e){var n=t.TileLayer,i=(t.Marker,t.Circle),u=(t.CircleMarker,t.Polyline),c=t.Pane,s=t.Tooltip,l=t.useMapEvents,d=t.useMap,p=e.setLL,h=e.setZoom,v=e.stations,y=e.stationCounts,g=e.selectedStation,_=e.setSelectedStation,j=e.stationPairCounts,x=e.url,S=e.attribution,Z=function(t){var e=t.id,n=t.count,r=t.selected,o=v[e],u=o.name,c=o.lat,l=o.lng;return(0,a.jsx)(i,{center:{lat:c,lng:l},color:r?"yellow":"orange",radius:w(n),eventHandlers:{click:function(){e!=g&&(console.log("click:",u),_(e))},mouseover:function(){e!=g&&(console.log("over:",u),_(e))},mousedown:function(){e!=g&&(console.log("down:",u),_(e))}},children:(0,a.jsxs)(s,{sticky:!0,children:[u,": ",n]})},e)},O=d(),k=O.getZoom(),C=(0,f.useMemo)((function(){return function(t){var e=t.getCenter(),n=t.latLngToContainerPoint(e),r=[n.x+1,n.y],o=t.containerPointToLatLng(n),a=t.containerPointToLatLng(r);return o.distanceTo(a)}(O)}),[O,k]);l({moveend:function(){return p(O.getCenter())},zoom:function(){return h(O.getZoom())},click:function(){_(void 0)}});var E=(0,f.useMemo)((function(){var t;if(!g||!j)return null;var e=j[g];console.log("selectedPairCounts:",e);var n=Array.from(Object.values(e)),i=(t=Math).max.apply(t,(0,o.Z)(n)),l=y[g],d=v[g];return(0,a.jsx)(c,{name:"lines",className:m().lines,children:b(e).map((function(t){var e=(0,r.Z)(t,2),n=e[0],o=e[1];if(n in v){var c=v[n],f=c.name,p=c.lat,m=c.lng;return(0,a.jsx)(u,{color:"red",positions:[[d.lat,d.lng],[p,m]],weight:Math.max(.7,o/i*w(l)/C),opacity:.7,children:(0,a.jsxs)(s,{sticky:!0,children:[d.name," \u2192 ",f,": ",o]})},"".concat(g,"-").concat(n,"-").concat(k))}console.log("id ".concat(n," not in stations:"),v)}))})}),[j,g,y,C]),M=g?Array.from(b(y).filter((function(t){var e=(0,r.Z)(t,2),n=e[0];e[1];return n==g})))[0]:void 0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{name:"selected",className:m().selected,children:M&&[M].map((function(t){var e=(0,r.Z)(t,2),n=e[0],o=e[1];return(0,a.jsx)(Z,{id:n,count:o,selected:!0},n)}))}),E,(0,a.jsx)(c,{name:"circles",className:m().circles,children:b(y).map((function(t){var e=(0,r.Z)(t,2),n=e[0],o=e[1];return(0,a.jsx)(Z,{id:n,count:o},n)}))}),(0,a.jsx)(n,{url:x,attribution:S})]})}function O(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=/^20(\d{4})$/,r=/^\d{4}$/;return{encode:function(e){if(e!=t){var r=e.match(n);return r?r[1]:void console.warn("Invalid ym param: ".concat(e))}},decode:function(e){return e?e.match(r)?"20".concat(e):(console.warn("Invalid ym param value: ".concat(e)),t):t},push:e}}function k(t){var e=t.defaults,n=t.stations,o={ll:d({init:_,places:3}),z:(0,l.yc)(12,!1),ss:(0,l.ON)(),ym:O(e.ym)},i=(0,l.O5)({params:o}),c=(0,r.Z)(i.ll,2),p=c[0],h=p.lat,y=p.lng,w=c[1],x=(0,r.Z)(i.z,2),k=x[0],C=x[1],E=(0,r.Z)(i.ss,2),M=E[0],P=E[1],A=(0,r.Z)(i.ym,2),L=A[0],T=(A[1],(0,f.useState)(e.stationCounts)),N=T[0],R=T[1],I=(0,f.useState)(null),z=I[0],q=I[1],D=(0,f.useMemo)((function(){var t,n=parseInt(L.substring(0,4)),o=parseInt(L.substring(4)),a=new Date(n,o-1).toLocaleDateString("default",{month:"short",year:"numeric"}),i="https://ctbk.s3.amazonaws.com/aggregated/".concat(L),u="".concat(i,"/idx2id.json"),c="".concat(i,"/s_c.json"),s="".concat(i,"/se_c.json");return L==e.ym?(R(e.stationCounts),t=Promise.resolve(e.idx2id),console.log("Setting stationCounts to default")):(console.log("fetching ".concat(c)),t=v()(u).then((function(t){return t.json()})).then((function(t){return console.log("got idx2id:",t),t})),v()(c).then((function(t){return t.json()})).then((function(e){return t.then((function(t){console.log("got stationCounts:",e),R(g().mapKeys(e,(function(e,n){return t[n]})))}))}))),console.log("fetching ".concat(s)),v()(s).then((function(t){return t.json()})).then((function(e){return t.then((function(t){console.log("got stationPairCounts:",e),q(j(b(e).map((function(e){var n=(0,r.Z)(e,2),o=n[0],a=n[1];return[t[o],g().mapKeys(a,(function(e,n){return t[n]}))]}))))}))})),{ymString:a}}),[L]).ymString,F="Citi Bike rides by station, ".concat(D),U=S.alidade_smooth_dark,G=U.url,H=U.attribution;return(0,a.jsxs)("div",{className:m().container,children:[(0,a.jsxs)(u(),{children:[(0,a.jsx)("title",{children:F}),(0,a.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,a.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,a.jsx)("meta",{property:"og:url",content:"https://ctbk.dev/stations"},"ogurl"),(0,a.jsx)("meta",{property:"og:type",content:"website"}),(0,a.jsx)("meta",{property:"og:image",content:"https://ctbk.dev/stations-screenshot.png"},"ogimage"),(0,a.jsx)("meta",{property:"og:site_name",content:"ctbk.dev"},"ogsitename"),(0,a.jsx)("meta",{property:"og:title",content:"Citi Bike Station Ridership Map"},"ogtitle"),(0,a.jsx)("meta",{property:"og:description",content:"Map of Citi Bike stations' ridership in August 2022"},"ogdesc")]}),(0,a.jsx)("main",{className:m().main,children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s,{className:m().homeMap,center:{lat:h,lng:y},zoom:k,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,children:function(t){return(0,a.jsx)("div",{children:Z(t,{setLL:w,setZoom:C,stations:n,stationCounts:N,selectedStation:M,setSelectedStation:P,stationPairCounts:z,url:G,attribution:H})})}}),F&&(0,a.jsx)("div",{className:m().title,children:F})]})})]})}},61494:function(t,e,n){"use strict";n.d(e,{O5:function(){return _},ON:function(){return l},W$:function(){return h},Yg:function(){return y},gO:function(){return v},wO:function(){return g},yc:function(){return d}});var r=n(82670),o=n(828),a=n(11163),i=n(67294),u=n(96486),c=n.n(u),s=RegExp("[^?#]+","u");function l(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return{encode:function(t){return t},decode:function(t){return t},push:t}}function d(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return{encode:function(e){return e===t?void 0:e.toString()},decode:function(e){return e?parseFloat(e):t},push:e}}var f=Object.entries,p=Object.fromEntries,m=Object.keys;function h(t,e,n){var a=function(t){return Array.from(t).filter((function(t){return t in u||(console.warn("Invalid value: ".concat(t," not in ").concat(m(u).join(", "))),!1)}))},i=void 0===n?"_":n,u=(0,r.Z)(e,Array)?p(e):e,c=p(f(u).map((function(t){var e=(0,o.Z)(t,2),n=e[0];return[e[1],n]}))),s=function(t){return a(t).map((function(t){return u[t]})).join(i)},l=s(t);return{encode:function(t){var e=s(t);if(e!==l)return e},decode:function(e){if(!e&&""!==e)return t;var n=e.split(i).filter((function(t){return t in c||(console.warn("Unrecognized value: ".concat(t," not in ").concat(m(c).join(","))),!1)})).map((function(t){return c[t]}));return n=a(n)}}}function v(t,e){var n=(0,r.Z)(e,Array)?p(e):e,a=p(f(n).map((function(t){var e=(0,o.Z)(t,2),n=e[0];return[e[1],n]})));return{encode:function(e){if(e!=t)return n[e]},decode:function(e){return void 0===e?t:e in a?a[e]:(console.warn("Invalid enum: ".concat(e," not in ").concat(m(a).join(","))),t)}}}var y={encode:function(t){return t?"":void 0},decode:function(t){return void 0!==t}};function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=c().isEqual;return{encode:function(n){if(!e(n,t))return n.map((function(t){return t.toString()})).join(",")},decode:function(e){return void 0===e?t:e.split(",").map(parseInt)}}}function _(t){var e=t.params,n=(0,a.useRouter)(),r=n.asPath,u=r.replace(s,""),l=Object.fromEntries(new URLSearchParams(u).entries()),d=Object.fromEntries(Object.entries(e).map((function(t){var e=(0,o.Z)(t,2),n=e[0],r=e[1],a=(0,i.useState)(r.decode(l[n]));return[n,{val:a[0],set:a[1],param:r}]})));Object.values(d).map((function(t){return t.set}));(0,i.useEffect)((function(){window.onpopstate=function(t){var n=t.state.url,r=n.replace(s,"");console.log("onpopstate:",t,"newUrl:",n,"newSearchStr:",r,"oldSearchStr:",u);var a=Object.fromEntries(new URLSearchParams(r).entries());Object.entries(e).forEach((function(t){var e=(0,o.Z)(t,2),n=e[0],r=e[1].decode(a[n]),i=d[n],u=i.val,s=i.set,l=c().isEqual(u,r);l||(console.log("back! setting: ".concat(n,", ").concat(u," -> ").concat(r," (change: ").concat(!l,")")),s(r))}))}}),[r]),(0,i.useEffect)((function(){console.log("updating states: path",r,", searchStr:",u),Object.entries(e).forEach((function(t){var e=(0,o.Z)(t,2),n=e[0],r=e[1].decode(l[n]),a=d[n],i=a.val,u=a.set,s=c().isEqual(i,r);s||(console.log("update state: ".concat(n,", ").concat(i," -> ").concat(r," (change: ").concat(!s,")")),u(r))}))}),[r]);var m=r.match(s),h=m?m[0]:r,v={};Object.entries(d).map((function(t){var e=(0,o.Z)(t,2),n=e[0],r=e[1],a=r.val,i=r.param.encode(a);void 0!==i&&(v[n]=i)}));var y=new URLSearchParams(v).toString();return console.log("path: ".concat(r,", searchStr: ").concat(u,", searchObj: "),l,", search: ".concat(y,", query:"),v),(0,i.useEffect)((function(){var t=[],r=!0,a=!1,i=void 0;try{for(var u,s=f(l)[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var d=(0,o.Z)(u.value,2),p=d[0],m=d[1];p in v&&c().isEqual(m,v[p])||t.push(p)}}catch(I){a=!0,i=I}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}var g=!0,_=!1,b=void 0;try{for(var j,w=f(v)[Symbol.iterator]();!(g=(j=w.next()).done);g=!0){var x=(0,o.Z)(j.value,2),S=x[0],Z=x[1];t.includes(S)||S in l&&c().isEqual(Z,l[S])||t.push(S)}}catch(I){_=!0,b=I}finally{try{g||null==w.return||w.return()}finally{if(_)throw b}}var O=!1,k=!0,C=!1,E=void 0;try{for(var M,P=t[Symbol.iterator]();!(k=(M=P.next()).done);k=!0){var A=M.value;if(e[A].push){O=!0;break}}}catch(I){C=!0,E=I}finally{try{k||null==P.return||P.return()}finally{if(C)throw E}}var L={pathname:n.pathname,hash:"",search:y},T={pathname:h,hash:"",search:y},N={shallow:!0,scroll:!1},R=O?"push":"replace";console.log("router.".concat(R,":"),{pathname:n.pathname,hash:"",search:y},"changedKeys:",t),O?n.push(L,T,N):n.replace(L,T,N)}),[h,n.pathname,y]),p(f(d).map((function(t){var e=(0,o.Z)(t,2),n=e[0],r=e[1];return[n,[r.val,r.set]]})))}},45553:function(t){t.exports={container:"stations_container__Z0llF",main:"stations_main__xJuAQ",title:"stations_title__Lq0Hh",homeMap:"stations_homeMap__Ms8dh",selected:"stations_selected__AMT5f",circles:"stations_circles__T0Q2o",lines:"stations_lines__8OJmu"}},5152:function(t,e,n){t.exports=n(90638)},9008:function(t,e,n){t.exports=n(5443)},11163:function(t,e,n){t.exports=n(90387)},83300:function(t,e){"use strict";var n=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n)return n;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response},20943:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.d(e,{Z:function(){return r}})},82670:function(t,e,n){"use strict";function r(t,e){return null!=e&&"undefined"!==typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}n.d(e,{Z:function(){return r}})},13375:function(t,e,n){"use strict";function r(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n.d(e,{Z:function(){return r}})},828:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var r=n(13375);var o=n(91566);function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||(0,r.Z)(t,e)||(0,o.Z)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},29815:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(20943);var o=n(13375);var a=n(91566);function i(t){return function(t){if(Array.isArray(t))return(0,r.Z)(t)}(t)||(0,o.Z)(t)||(0,a.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},91566:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=n(20943);function o(t,e){if(t){if("string"===typeof t)return(0,r.Z)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(t,e):void 0}}}},function(t){t.O(0,[662,774,888,179],(function(){return e=97434,t(t.s=e);var e}));var e=t.O();_N_E=e}]);