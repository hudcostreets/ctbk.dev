(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7631)}])},7631:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return se},default:function(){return ue}});var r=t(41799),a=t(99534),i=t(828),o=t(29815),c=t(85893),s=t(67294),u=t(28781),l=t(5152),d=t.n(l),h=Object.fromEntries;function f(e){var n=e.label,t=e.data,a=e.cb,i=e.children,o=h(t.map((function(e){return[e.name,{data:e.data,checked:e.checked||!1}]}))),s=t.map((function(e){var n=e.name,t=e.disabled,r=o[n].checked;return(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"checkbox",name:n,value:n,checked:r,disabled:t,onChange:function(){}}),n]},n)}));return(0,c.jsxs)("div",{className:"control col",children:[(0,c.jsxs)("div",{className:"control-header",children:[n,":"]}),(0,c.jsx)("div",{onChange:function(e){var n=e.target.value,t=e.target.checked,i=o[n],c=i.checked,s=i.data;if(c==t)console.warn("Checkbox",n,"already has value",t);else{var u=(0,r.Z)({},o);u[n]={data:s,checked:t};var l=Object.keys(u).filter((function(e){return u[e].checked})).map((function(e){return u[e].data}));a(l)}},className:"sub-control",children:s}),i]})}function p(e){var n=e.label,t=e.options,r=e.choice,a=e.cb,i=e.children,o=t.map((function(e){var t="string"===typeof e?{label:e,data:e,disabled:!1}:e,a=t.label,i=t.data,o=t.disabled;return(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"radio",name:n+"-"+i,value:i,checked:i==r,disabled:o,onChange:function(e){}}),a]},i)}));return(0,c.jsxs)("div",{className:"control col",children:[(0,c.jsxs)("div",{className:"control-header",children:[n,":"]}),(0,c.jsx)("div",{id:n,className:"sub-control",onChange:function(e){return a(e.target.value)},children:o}),i]})}var b=t(51438),m=t(88029),v=t(16567),g=function(e){(0,m.Z)(t,e);var n=(0,v.Z)(t);function t(){return(0,b.Z)(this,t),n.apply(this,arguments)}return t.prototype.render=function(){var e=this.props,n=e.id,t=e.label,r=e.checked,a=e.cb;return(0,c.jsx)("div",{id:n,className:"sub-control",children:(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return a(e.target.checked)}}),t]})})},t}(s.Component),y=t(30381),k=t.n(y),w=t(96486),x=t.n(w),j=t(61494);function O(e,n,t){if("Default"===t)return n;var r="Unexpected value ".concat(e," in decoded query param; returning default ").concat(n);if("Warn"===t)return console.error(r),n;throw new Error(r)}var C=k()("2013-06-01").toDate(),N=function(e){return e?k()(e).format("YYMM"):""},R=function(e){var n="20".concat(e.substring(0,2)),t=e.substring(2,4);return k()("".concat(n,"-").concat(t,"-01")).toDate()};function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.defaultValue,t=void 0===n?"All":n,r=e.handleUnexpectedValue,a=void 0===r?"Warn":r,o=x().isEqual;return{encode:function(e){if(!o(e,t)){if("string"===typeof e)return e;var n=e.start,r=e.end;return"".concat(N(n),"-").concat(N(r))}},decode:function(e){if(void 0===e)return t;if(null===e)return O(e,"All",a);if(["All","1y","2y","3y","4y","5y"].includes(e))return e;var n=(0,i.Z)(e.split("-").map((function(e){return e?R(e):void 0})),2);return{start:n[0],end:n[1]}}}}var D=t(41664),E=t.n(D),S=u.D,U=d()((function(){return t.e(762).then(t.bind(t,24762))}),{loadableGenerated:{webpack:function(){return[24762]}},ssr:!1}),A=d()((function(){return Promise.all([t.e(960),t.e(660)]).then(t.bind(t,58660))}),{loadableGenerated:{webpack:function(){return[58660]}},ssr:!1}),T=Object.entries,_=Object.values,M=Object.keys,F=Object.fromEntries,Y=Array.from,G=["NYC","JC","HB"],J=[["HB","h"],["NYC","n"],["JC","j"]],z={NYC:"NYC",JC:"JC",HB:"HOB"},H=[["All","a"],["Subscriber","s"],["Customer","c"]],q=["Male","Female","Other / Unspecified"],P=[["Male","m"],["Female","f"],["Other / Unspecified","u"]],L={0:"Other / Unspecified",1:"Male",2:"Female"},B=new Date("2021-02-01"),I=["Docked","Electric","Unknown"],W=[["Docked","d"],["Electric","e"],["Unknown","u"]],$={docked_bike:"Docked",classic_bike:"Docked",electric_bike:"Electric",unknown:"Unknown",motivate_dockless_bike:"Unknown"},V=[["None","n"],["Region","r"],["Gender","g"],["User Type","u"],["Rideable Type","r"]],X=[["Rides","r"],["Ride minutes","m"]],K={Rides:{yAxis:"Total Rides",title:"Citibike Rides per Month",hoverLabel:"Rides"},"Ride minutes":{yAxis:"Total Ride Minutes",title:"Citibike Ride Minutes per Month",hoverLabel:"Minutes"}};function Q(e){return M(e).sort().reduce((function(n,t){return n[t]=e[t],n}),{})}function ee(e){return _(e).reduce((function(e,n){return e+n}),0)}function ne(e,n){return function(e,n){return F(T(e).map((function(e){var t=(0,i.Z)(e,2),r=t[0],a=t[1];return n(r,a)})))}(e,(function(e,t){return[e,n(e,t)]}))}function te(e,n){return F(T(e).filter((function(e){var t=(0,i.Z)(e,2),r=t[0],a=t[1];return n(r,a)})))}function re(e,n,t){for(var r=[],a=t?function(e){return t(e)}:function(e){return e},i=0,o=0;o<e.length;o++)if(i+=a(e[o]),o>=n){var c=(i-=a(e[o-n]))/n;r.push([e[o],c])}else r.push([e[o],null]);return r}var ae={1:[1],2:[.75,1],3:[.65,.8,1]},ie={None:{"":"0"},Region:{NYC:"6",HB:"D",JC:"E"},"User Type":{Customer:"D",Subscriber:"7"},Gender:{Male:"6",Female:"D","Other / Unspecified":"E"},"Rideable Type":{Docked:"E",Electric:"D",Unknown:"6"}};function oe(e,n){return("0"+e.toString(16)).substr(-n)}function ce(e){var n="".concat(e-1,"-12-20");return{layer:"below",type:"line",x0:n,y0:0,x1:n,yref:"paper",y1:1,line:{color:"#555555"}}}var se=!0;function ue(e){var n,t=e.data,u=function(e,n,t){return(0,c.jsx)("a",{href:n,title:t,children:(0,c.jsx)("img",{className:"icon",src:"/assets/".concat(e,".png")})})},l={y:(0,j.gO)("Rides",X),u:(0,j.gO)("All",H),s:(0,j.gO)("None",V),pct:j.Yg,r:(0,j.W$)(G,J,""),g:(0,j.W$)(q,P,""),rt:(0,j.W$)(I,W,""),d:Z(),rolling:(0,j.wO)([12])},d=(0,j.O5)({params:l}),h=(0,i.Z)(d.y,2),b=h[0],m=h[1],v=(0,i.Z)(d.u,2),y=v[0],w=v[1],O=(0,i.Z)(d.s,2),N=O[0],R=O[1],D=(0,i.Z)(d.pct,2),se=D[0],ue=D[1],le=(0,i.Z)(d.r,2),de=le[0],he=le[1],fe=(0,i.Z)(d.g,2),pe=fe[0],be=fe[1],me=(0,i.Z)(d.rt,2),ve=me[0],ge=(me[1],(0,i.Z)(d.d,2)),ye=ge[0],ke=ge[1],we=(0,i.Z)(d.rolling,2),xe=we[0],je=we[1],Oe=(0,s.useState)(!0),Ce=Oe[0],Ne=Oe[1],Re=K[b].yAxis,Ze=K[b].hoverLabel,De=K[b].title,Ee=[];de&&de.length<G.length&&Ee.push("".concat(de.map((function(e){return z[e]})).join(", "))),se&&(Re+=" (%)",Ze+=" (%)",Ee.push("%, by ".concat(N))),Ee.length&&(De+=" (".concat(Ee.join(";"),")"));var Se=t.map((function(e){var n=e.Gender,t=e["Rideable Type"],i=(0,a.Z)(e,["Gender","Rideable Type"]);return(0,r.Z)({Gender:L[n],"Rideable Type":$[t]},i)})).filter((function(e){return-1!=de.indexOf(e.Region)&&(("All"==y||y==e["User Type"])&&(-1!=pe.indexOf(e.Gender)&&(-1!=ve.indexOf(e["Rideable Type"])||(console.warn("Dropping",e.Count,"rides from with unrecognized rideable type",e["Rideable Type"],e),!1))))})),Ue={None:[""],"User Type":["Customer","Subscriber"],Gender:["Other / Unspecified","Male","Female"],"Rideable Type":["Docked","Electric","Unknown"],Region:["JC","HB","NYC"]}[N],Ae=null==Ce?"None"!=N:Ce,Te={},_e={};Se.forEach((function(e){var n="".concat(e.Year.toString(),"-").concat(e.Month.toString().padStart(2,"0")),t="None"==N?"":e[N],r="Rides"==b?e.Count:e.Duration;n in Te||(Te[n]={});var a=Te[n];t in a||(a[t]=0),a[t]+=r,t in _e||(_e[t]={}),n in(a=_e[t])||(a[n]=0),a[n]+=r})),Te=Q(Te),_e=F(Ue.map((function(e){return[e,Q(_e[e]||{})]})));var Me=Y(M(Te));if(N&&se){var Fe=ne(Te,(function(e,n){return ee(n)}));Te=ne(Te,(function(e,n){return ne(n,(function(n,t){return t/Fe[e]*100}))})),_e=ne(_e,(function(e,n){return ne(n,(function(e,n){return n/Fe[e]*100}))}))}var Ye=k()(x().max(t.map((function(e){return new Date(e.Year,e.Month-1)})))).add(1,"d").toDate(),Ge=function(e,n){if(n=n||new Date,"All"==e)return{start:C,end:n};if("string"===typeof e){var t=new Date(n);if("y"!=e[e.length-1])throw Error("Unrecognized date range string: ".concat(e));var r=parseInt(e.substr(0,e.length-1));return t.setFullYear(t.getFullYear()-r),console.log("subtracted ".concat(r," years: ").concat(t,", ").concat(n)),{start:t,end:n}}var a=e.start,i=e.end;return{start:a||C,end:i||n}}(ye,Ye),Je=Ge.start,ze=Ge.end,He=[];if(He=(n=He).concat.apply(n,(0,o.Z)(_(_e).map((function(e){var n=T(e).map((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];return{month:new Date(t),v:r}}));return"Gender"==N&&(n=n.filter((function(e){return e.month<B}))),xe.map((function(e){return re(n,e,(function(e){return e.v})).filter((function(e){var n=(0,i.Z)(e,2),t=n[0].month;n[1];return Je<=t&&t<ze})).map((function(e){var n=(0,i.Z)(e,2);n[0];return n[1]}))}))})))),"None"!=N&&!se){var qe=T(Te).map((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];return{month:new Date(t),total:ee(r)}})),Pe=xe.map((function(e){return re(qe,e,(function(e){return e.total})).filter((function(e){var n=(0,i.Z)(e,2),t=n[0].month;n[1];return Je<=t&&t<ze})).map((function(e){var n=(0,i.Z)(e,2);n[0];return n[1]}))}));He=He.concat(Pe)}var Le=function(e){var n=new Date(e);return Je<=n&&n<ze},Be=function(){return function(e,n){return Le(e)}};Me=Me.filter(Le),_e=ne(_e,(function(e,n){return te(n,Be())})),Te=te(Te,Be());var Ie=Me.map((function(e){return new Date(e)})).filter((function(e){return 0==e.getMonth()})).map((function(e){return e.getFullYear()})),We=(0,o.Z)(new Set(Ie)).map(ce),$e=ie[N];$e.Total="0";var Ve=He.map((function(e,n){var t=Ue[n]||"Total",r="Total"==t?"12mo avg":"".concat(t," (12mo)"),a=$e[t];return{name:r,x:Me,y:e,type:"scatter",marker:{color:"#"+a+a+a+a+a+a},line:{width:4}}})),Xe=ae[Ue.length],Ke=T(_e).map((function(e,n){var t=(0,i.Z)(e,2),r=t[0],a=t[1],o=Me,c=Me.map((function(e){return a[e]||0})),s=r||Ze,u=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return"#"+[e.substring(1,3),e.substring(3,5),e.substring(5,7)].map((function(e){return oe(Math.round(parseInt(e,16)*n),2)})).join("")}("#88aaff",Xe[n]);return{x:o,y:c,name:s,type:"bar",marker:{color:u}}})),Qe=Ke.concat(Ve),en=(0,c.jsxs)("span",{children:["Gender",(0,c.jsx)("span",{"data-tip":!0,"data-for":"gender-label-tooltip",children:(0,c.jsx)("img",{className:"warning icon",src:"/assets/warning.png"})})]});return(0,c.jsxs)("div",{id:"plot",className:"container",children:[(0,c.jsx)(A,{onDoubleClick:function(){return ke("All")},onRelayout:function(e){if("xaxis.range[0]"in e&&"xaxis.range[1]"in e){var n=(0,i.Z)([e["xaxis.range[0]"],e["xaxis.range[1]"]].map((function(e){return e?new Date(e):void 0})),2),t=n[0],r=n[1];t=t?k()(t).subtract(1,"month").toDate():t,ke(t||r?{start:t,end:r}:"All")}},data:Qe,useResizeHandler:!0,layout:{titlefont:{size:18},autosize:!0,barmode:"stack",showlegend:Ae,legend:{x:.5,y:1.12,xanchor:"center",orientation:"h"},title:De,xaxis:{title:"Month",tickfont:{size:14},titlefont:{size:14}},yaxis:{automargin:!0,gridcolor:"#DDDDDD",title:{text:Re},tickfont:{size:14},titlefont:{size:14},range:se?[0,100]:void 0},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",shapes:We,margin:{b:40,l:20,r:10}}}),(0,c.jsx)("div",{className:"no-gutters row date-controls",children:(0,c.jsx)("div",{className:"col-6",children:[,"1y","2y","3y","4y","5y","All"].map((function(e){return(0,c.jsx)("input",{type:"button",value:e,className:"date-range-button",onClick:function(){return ke(e)},disabled:ye==e},e)}))})}),(0,c.jsxs)("div",{className:"no-gutters row",children:[(0,c.jsx)(f,{label:"Region",data:G.map((function(e){return{name:z[e],data:e,checked:de.includes(e)}})),cb:he}),(0,c.jsx)(p,{label:"User Type",options:["All","Subscriber","Customer"],cb:w,choice:y}),(0,c.jsx)(p,{label:"Y Axis",options:["Rides","Ride minutes"],cb:m,choice:b}),(0,c.jsx)(f,{label:"Rolling Avg",data:[{name:"12mo",data:12,checked:xe.includes(12)}],cb:je,children:(0,c.jsx)(g,{id:"showlegend",label:"Legend",checked:Ae,cb:Ne})}),(0,c.jsx)(p,{label:"Stack by",options:["None","Region","User Type",{label:en,data:"Gender"}],cb:R,choice:N,children:(0,c.jsx)(g,{id:"stack-relative",label:"Percentages",checked:se,cb:ue})}),(0,c.jsx)(f,{label:en,data:[{name:"Male",data:"Male",checked:pe.includes("Male")},{name:"Female",data:"Female",checked:pe.includes("Female")},{name:"Other / Unspecified",data:"Other / Unspecified",checked:pe.includes("Other / Unspecified")}],cb:be}),(0,c.jsxs)(U,{id:"gender-label-tooltip",className:"label-tooltip",children:[(0,c.jsx)("div",{children:"Gender data no longer published"}),(0,c.jsx)("div",{children:"(as of February 2021)"})]})]}),(0,c.jsx)("div",{className:"no-gutters row",children:(0,c.jsxs)("div",{className:"col-md-12",children:[(0,c.jsx)("h2",{children:"About"}),(0,c.jsx)("p",{children:"Use the controls above to filter/stack by region, user type, gender, or date, and toggle aggregation of rides or total ride minutes, e.g.:"}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:(0,c.jsx)(E(),{href:"/?r=jh",children:"JC+Hoboken"})}),(0,c.jsxs)("li",{children:[(0,c.jsx)(E(),{href:"/?y=m&s=g&pct=&g=mf&d=1406-2101",children:"Ride minute %'s, Male vs. Female"})," (Jun 2014 - January 2021, the window where 12mo rolling avgs are possible)"]})]}),(0,c.jsx)("p",{children:"This plot should refresh when [new data is published by Citibike](https://www.citibikenyc.com/system-data) (typically around the 2nd week of each month, covering the previous month)."}),(0,c.jsxs)("p",{children:[(0,c.jsx)("a",{href:"https://github.com/neighbor-ryan/ctbk.dev",children:"The GitHub repo"})," has more info as well as ",(0,c.jsx)("a",{href:"https://github.com/neighbor-ryan/ctbk.dev/issues",children:"planned enhancements"}),"."]}),(0,c.jsx)("h3",{id:"qc",children:"\ud83d\udea7 Data-quality issues \ud83d\udea7"}),(0,c.jsx)(S,{children:'\nSeveral things changed in February 2021 (presumably as part of [the Lyft acquistion](https://www.lyft.com/blog/posts/lyft-becomes-americas-largest-bikeshare-service)):\n- "Gender" information no longer provided (all rides labeled "unknown" starting February 2021)\n- A new "Rideable Type" field was added, containing values `docked_bike` and `electric_bike` \ud83c\udf89; however, it is mostly incorrect at present, and disabled above:\n  - Prior to February 2021, the field is absent (even though e-citibikes were in widespread use before then)\n  - Since February 2021, only a tiny number of rides are labeled `electric_bike` (122 in April 2021, 148 in May, 113 in June); this is certainly not accurate!\n    - One possible explanation: [electric citibikes were launched in Jersey City and Hoboken around April 2021](https://www.hobokengirl.com/hoboken-jersey-city-citi-bike-share-program/); perhaps those bikes were part of a new fleet that show up as `electric_bike` in the data (while extant NYC e-citibikes don\'t).\n    - These `electric_bike` rides showed up in the default ("NYC") data, not the "JC" data, but it could be all in flux; February through April 2021 were also updated when the May 2021 data release happened in early June.\n- The "User Type" values changed ("Subscriber" \u2192 "member", "Customer" \u2192 "casual"); I\'m using the former/old values here, they seem equivalent.\n                    '}),(0,c.jsxs)("div",{className:"footer",children:["Code: ",u("gh","https://github.com/neighbor-ryan/ctbk.dev#readme","GitHub logo"),"Data: ",u("s3","https://s3.amazonaws.com/ctbk/index.html","Amazon S3 logo"),"Author: ",u("twitter","https://twitter.com/RunsAsCoded","Twitter logo")]})]})})]})}},61494:function(e,n,t){"use strict";t.d(n,{O5:function(){return g},W$:function(){return p},Yg:function(){return m},gO:function(){return b},wO:function(){return v},yc:function(){return l}});var r=t(82670),a=t(828),i=t(11163),o=t(67294),c=t(96486),s=t.n(c),u=RegExp("[^?#]+","u");function l(e){return{encode:function(n){return n===e?void 0:n.toString()},decode:function(n){return n?parseFloat(n):e}}}var d=Object.entries,h=Object.fromEntries,f=Object.keys;function p(e,n,t){var i=function(e){return Array.from(e).filter((function(e){return e in c||(console.warn("Invalid value: ".concat(e," not in ").concat(f(c).join(", "))),!1)}))},o=void 0===t?"_":t,c=(0,r.Z)(n,Array)?h(n):n,s=h(d(c).map((function(e){var n=(0,a.Z)(e,2),t=n[0];return[n[1],t]}))),u=function(e){return i(e).map((function(e){return c[e]})).join(o)},l=u(e);return{encode:function(e){var n=u(e);if(n!==l)return n},decode:function(n){if(!n&&""!==n)return e;var t=n.split(o).filter((function(e){return e in s||(console.warn("Unrecognized value: ".concat(e," not in ").concat(f(s).join(","))),!1)})).map((function(e){return s[e]}));return t=i(t)}}}function b(e,n){var t=(0,r.Z)(n,Array)?h(n):n,i=h(d(t).map((function(e){var n=(0,a.Z)(e,2),t=n[0];return[n[1],t]})));return{encode:function(n){if(n!=e)return t[n]},decode:function(n){return void 0===n?e:n in i?i[n]:(console.warn("Invalid enum: ".concat(n," not in ").concat(f(i).join(","))),e)}}}var m={encode:function(e){return e?"":void 0},decode:function(e){return void 0!==e}};function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=s().isEqual;return{encode:function(t){if(!n(t,e))return t.map((function(e){return e.toString()})).join(",")},decode:function(n){return void 0===n?e:n.split(",").map(parseInt)}}}function g(e){var n=e.params,t=(0,i.useRouter)(),r=t.asPath,c=r.replace(u,""),l=Object.fromEntries(new URLSearchParams(c).entries()),f=Object.fromEntries(Object.entries(n).map((function(e){var n=(0,a.Z)(e,2),t=n[0],r=n[1],i=(0,o.useState)(r.decode(l[t]));return[t,{val:i[0],set:i[1],param:r}]})));Object.values(f).map((function(e){return e.set}));(0,o.useEffect)((function(){window.onpopstate=function(e){var t=e.state.url,r=t.replace(u,"");console.log("onpopstate:",e,"newUrl:",t,"newSearchStr:",r,"oldSearchStr:",c);var i=Object.fromEntries(new URLSearchParams(r).entries());Object.entries(n).forEach((function(e){var n=(0,a.Z)(e,2),t=n[0],r=n[1].decode(i[t]),o=f[t],c=o.val,u=o.set,l=s().isEqual(c,r);l||(console.log("back! setting: ".concat(t,", ").concat(c," -> ").concat(r," (change: ").concat(!l,")")),u(r))}))}}),[r]),(0,o.useEffect)((function(){console.log("updating states: path",r,", searchStr:",c),Object.entries(n).forEach((function(e){var n=(0,a.Z)(e,2),t=n[0],r=n[1].decode(l[t]),i=f[t],o=i.val,c=i.set,u=s().isEqual(o,r);u||(console.log("update state: ".concat(t,", ").concat(o," -> ").concat(r," (change: ").concat(!u,")")),c(r))}))}),[r]);var p=r.match(u),b=p?p[0]:r,m={};Object.entries(f).map((function(e){var n=(0,a.Z)(e,2),t=n[0],r=n[1],i=r.val,o=r.param.encode(i);void 0!==o&&(m[t]=o)}));var v=new URLSearchParams(m).toString();return console.log("path: ".concat(r,", searchStr: ").concat(c,", searchObj: "),l,", search: ".concat(v,", query:"),m),(0,o.useEffect)((function(){console.log("router.push:",{pathname:t.pathname,hash:"",search:v}),t.push({pathname:t.pathname,hash:"",search:v},{pathname:b,hash:"",search:v},{shallow:!0,scroll:!1})}),[b,t.pathname,v]),h(d(f).map((function(e){var n=(0,a.Z)(e,2),t=n[0],r=n[1];return[t,[r.val,r.set]]})))}}},function(e){e.O(0,[662,885,632,774,888,179],(function(){return n=48312,e(e.s=n);var n}));var n=e.O();_N_E=n}]);