(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{97434:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stations",function(){return e(28340)}])},28340:function(t,n,e){"use strict";e.r(n),e.d(n,{MAPS:function(){return w},__N_SSG:function(){return x},default:function(){return M},ymParam:function(){return k}});var o=e(10253),a=e(36305),s=e(85893),i=e(8974),r=e(5152),c=e.n(r)()(function(){return Promise.all([e.e(269),e.e(722)]).then(e.bind(e,14722))},{loadableGenerated:{webpack:function(){return[14722]}},ssr:!1}),l=e(48765),u=e(67294),d=e(33753),m=e.n(d),f=e(83300),p=e.n(f),h=e(96486),g=e.n(h),_={lat:40.758,lng:-73.965},v=Object.entries,y=Object.fromEntries,b=Object.keys,j=Math.sqrt,x=!0,w={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}};function k(t){var n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],e=/^20(\d{4})$/,o=/^\d{4}$/;return{encode:function(n){if(n!=t){var o=n.match(e);return o?o[1]:(console.warn("Invalid ym param: ".concat(n)),void 0)}},decode:function(n){return n?n.match(o)?"20".concat(n):(console.warn("Invalid ym param value: ".concat(n)),t):t},push:n}}function M(t){var n=t.defaults,e={ll:(0,l.GS)({init:_,places:3}),z:(0,l.yc)(12,!1),ss:(0,l.ON)(),ym:k(n.ym)},r=(0,l.O5)({params:e}),d=(0,o.Z)(r.ll,2),f=d[0],h=f.lat,x=f.lng,M=d[1],S=(0,o.Z)(r.z,2),Z=S[0],P=S[1],C=(0,o.Z)(r.ss,2),N=C[0],L=C[1],O=(0,o.Z)(r.ym,2),T=O[0];O[1];var z=(0,u.useState)(n.stations),E=z[0],I=z[1],q=(0,u.useState)(null),A=q[0],R=q[1],H=(0,u.useMemo)(function(){var t,e=parseInt(T.substring(0,4)),a=parseInt(T.substring(4)),s=new Date(e,a-1).toLocaleDateString("default",{month:"short",year:"numeric"}),i="https://ctbk.s3.amazonaws.com/aggregated/".concat(T),r="".concat(i,"/se_c.json"),c="".concat(i,"/stations.json");return T==n.ym?(I(n.stations),console.log("Setting stations to default"),t=Promise.resolve(n.stations)):(console.log("fetching ".concat(c)),t=p()(c).then(function(t){return t.json()}).then(function(t){return console.log("got ".concat(v(t).length," stations")),I(t),t})),console.log("fetching ".concat(r)),Promise.all([t,p()(r).then(function(t){return t.json()})]).then(function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1],s=y(b(e).map(function(t,n){return[n,t]})),i=y(v(a).map(function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1];return[s[e],g().mapKeys(a,function(t,n){return s[n]})]}));console.log("got stationPairCounts (".concat(v(i).length," stations)")),R(i)}),{ymString:s}},[T]).ymString,D="Citi Bike rides by station, ".concat(H),F=w.alidade_smooth_dark,G=F.url,B=F.attribution;return(0,s.jsxs)("div",{className:m().container,children:[(0,s.jsx)(i.Z,{title:D,description:"Map of Citi Bike stations, including ridership counts and frequent destinations",path:"stations",thumbnail:"ctbk-stations"}),(0,s.jsxs)("main",{className:m().main,children:[(0,s.jsx)(c,{className:m().homeMap,center:{lat:h,lng:x},zoom:Z,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,children:function(t){var n,e,i,r,c,l,d,f,p,h,g,_,y,x,w,k,S,Z,C,O,T,z,I;return(0,s.jsx)("div",{children:(e={setLL:M,setZoom:P,stations:E,selectedStationId:N,setSelectedStationId:L,stationPairCounts:A,url:G,attribution:B},i=t.TileLayer,t.Marker,r=t.Circle,t.CircleMarker,c=t.Polyline,l=t.Pane,d=t.Tooltip,f=t.useMapEvents,p=t.useMap,h=e.setLL,g=e.setZoom,_=e.stations,y=e.selectedStationId,x=e.setSelectedStationId,w=e.stationPairCounts,k=e.url,S=e.attribution,Z=function(t){var n=t.id,e=t.count,o=t.selected;if(!(n in _))return console.log("id ".concat(n," not in stations")),null;var a=_[n],i=a.name,c=a.lat,l=a.lng;return(0,s.jsx)(r,{center:{lat:c,lng:l},color:o?"yellow":"orange",radius:j(e),eventHandlers:{click:function(){n!=y&&(console.log("click:",i),x(n))},mouseover:function(){n!=y&&(console.log("over:",i),x(n))},mousedown:function(){n!=y&&(console.log("down:",i),x(n))}},children:(0,s.jsxs)(d,{sticky:!0,children:[i,": ",e]})},n)},O=(C=p()).getZoom(),T=(0,u.useMemo)(function(){var t,n,e,o,a,s;return n=C.getCenter(),o=[(e=C.latLngToContainerPoint(n)).x+1,e.y],a=C.containerPointToLatLng(e),s=C.containerPointToLatLng(o),a.distanceTo(s)},[C,O,]),f({moveend:function(){return h(C.getCenter())},zoom:function(){return g(C.getZoom())},click:function(){x(void 0)}}),z=(0,u.useMemo)(function(){return y?_[y]:void 0},[_,y]),I=(0,u.useMemo)(function(){if(!z||!y||!w)return null;if(!(y in w))return console.log("".concat(y," not found among ").concat(b(w).length," stations")),null;var t,n=w[y],e=Array.from(Object.values(n)),i=(t=Math).max.apply(t,(0,a.Z)(e));return(0,s.jsx)(l,{name:"lines",className:m().lines,children:v(n).map(function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1];if(!(e in _)){console.log("id ".concat(e," not in stations:"),_);return}var r=_[e],l=r.name,u=r.lat,m=r.lng;return(0,s.jsx)(c,{color:"red",positions:[[z.lat,z.lng],[u,m],],weight:Math.max(.7,a/i*j(z.starts)/T),opacity:.7,children:(0,s.jsxs)(d,{sticky:!0,children:[z.name," â†’ ",l,": ",a]})},"".concat(y,"-").concat(e,"-").concat(O))})})},[w,y,T]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l,{name:"selected",className:m().selected,children:y&&z&&(0,s.jsx)(Z,{id:y,count:z.starts,selected:!0},y)}),I,(0,s.jsx)(l,{name:"circles",className:m().circles,children:v(_).map(function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1];return(0,s.jsx)(Z,{id:e,count:a.starts},e)})}),(0,s.jsx)(i,{url:k,attribution:S})]}))})}}),D&&(0,s.jsx)("div",{className:m().title,children:D})]})]})}},8974:function(t,n,e){"use strict";e.d(n,{Z:function(){return r}});var o=e(85893);e(67294);var a=e(78855),s="https://ctbk.dev",i="".concat(s,"/screenshots");function r(t){var n=t.title,e=t.description,r=t.path,c=t.thumbnail;return(0,o.jsxs)(a.F,{title:n,description:e,url:"".concat(s,"/").concat(r||""),thumbnail:"".concat(i,"/").concat(c,".png"),children:[(0,o.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,o.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,o.jsx)("meta",{property:"og:site_name",content:"ctbk.dev"},"ogsitename")]})}},33753:function(t){t.exports={container:"stations_container__Z0llF",main:"stations_main__xJuAQ",title:"stations_title__Lq0Hh",homeMap:"stations_homeMap__Ms8dh",selected:"stations_selected__AMT5f",circles:"stations_circles__T0Q2o",lines:"stations_lines__8OJmu"}},83300:function(t,n){"use strict";var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw Error("unable to locate global object")}();t.exports=n=e.fetch,e.fetch&&(n.default=e.fetch.bind(e)),n.Headers=e.Headers,n.Request=e.Request,n.Response=e.Response}},function(t){t.O(0,[662,171,774,888,179],function(){return t(t.s=97434)}),_N_E=t.O()}]);