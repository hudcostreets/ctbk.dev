(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(91577)}])},91577:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return er},default:function(){return ea}});var r=t(41799),a=t(99534),i=t(828),o=t(85893),c=t(30381),s=t.n(c),l=t(96486),d=t.n(l),u=t(67294),h=t(95408),p=t.n(h),b=t(57639),m=t.n(b),f=t(51438),x=t(88029),g=t(16567),v=function(e){(0,x.Z)(t,e);var n=(0,g.Z)(t);function t(){return(0,f.Z)(this,t),n.apply(this,arguments)}return t.prototype.render=function(){var e=this.props,n=e.id,t=e.className,r=void 0===t?m().checkbox:t,a=e.label,i=e.checked,c=e.nowrap,s=e.cb;return(0,o.jsx)("div",{id:n,className:"".concat(m().subControl," ").concat(r||""),children:(0,o.jsxs)("label",{className:void 0===c||c?m().nowrap:"",children:[(0,o.jsx)("input",{type:"checkbox",checked:i,onChange:function(e){return s(e.target.checked)}}),a]})})},t}(u.Component),y=Object.fromEntries;function k(e){var n=e.label,t=e.data,a=e.cb,i=e.nowrap,c=void 0===i||i,s=e.children,l=function(e){var n=e.target.value,t=e.target.checked,i=d[n],o=i.checked,c=i.data;if(o==t)console.warn("Checkbox",n,"already has value",t);else{var s=(0,r.Z)({},d);s[n]={data:c,checked:t};var l=Object.keys(s).filter(function(e){return s[e].checked}).map(function(e){return s[e].data});a(l)}},d=y(t.map(function(e){var n,t=e.name;return[t,{data:e.data,checked:e.checked||!1}]})),u=t.map(function(e){var n=e.name,t=e.disabled,r=d[n].checked;return(0,o.jsxs)("label",{className:c?m().nowrap:"",children:[(0,o.jsx)("input",{type:"checkbox",name:n,value:n,checked:r,disabled:t,onChange:function(){}}),n]},n)});return(0,o.jsxs)("div",{className:m().control,children:[(0,o.jsx)("div",{className:m().controlHeader,children:n}),(0,o.jsx)("div",{onChange:l,className:"".concat(m().subControl),children:u}),s]})}var _=s()("2013-06-01").toDate(),w=function(e){return e?s()(e).format("YYMM"):""},j=function(e){var n="20".concat(e.substring(0,2)),t=e.substring(2,4);return s()("".concat(n,"-").concat(t,"-01")).toDate()},N=function(e,n){if(n=n||new Date,"All"==e)return{start:_,end:n};if("string"==typeof e){var t,r=new Date(n);if("y"!=e[e.length-1])throw Error("Unrecognized date range string: ".concat(e));var a=parseInt(e.substr(0,e.length-1));return r.setFullYear(r.getFullYear()-a),console.log("subtracted ".concat(a," years: ").concat(r,", ").concat(n)),{start:r,end:n}}return{start:e.start||_,end:e.end||n}},C=t(8974);function R(e){var n=e.label,t=e.options,r=e.choice,a=e.cb,i=e.nowrap,c=void 0===i||i,s=e.children,l=t.map(function(e){var t="string"==typeof e?{label:e,data:e,disabled:!1}:e,a=t.label,i=t.data,s=t.disabled;return(0,o.jsxs)("label",{className:c?m().nowrap:"",children:[(0,o.jsx)("input",{type:"radio",name:n+"-"+i,value:i,checked:i==r,disabled:s,onChange:function(e){}}),a]},i)});return(0,o.jsxs)("div",{className:m().control,children:[(0,o.jsx)("div",{className:m().controlHeader,children:n}),(0,o.jsx)("div",{id:n,className:m().subControl,onChange:function(e){return a(e.target.value)},children:l}),s]})}var A=t(8158),D=t(79340),T=t(1051),U=t(48765),M=["NYC","JC","HOB",],E=[["HOB","h"],["NYC","n"],["JC","j"],],G=["Annual","Daily"],Z=[["Annual","a"],["Daily","d"],],F=["Men","Women","Unknown"],H=[["Men","m"],["Women","f"],["Unknown","u"],],O={0:"Unknown",1:"Men",2:"Women"},W=new Date("2021-02-01"),Y=["Classic","Electric","Unknown"],B=[["Classic","c"],["Electric","e"],["Unknown","u"]],S={docked_bike:"Classic",classic_bike:"Classic",electric_bike:"Electric",unknown:"Unknown",motivate_dockless_bike:"Unknown"},z=[["None","n"],["Region","r"],["Gender","g"],["User Type","u"],["Rideable Type","b"],],J={None:{"":"#636EFA",Total:"black"},Region:{NYC:"#636efa",HOB:"#63aefa",JC:"#632bfa"},Gender:{Unknown:"#AB63FA",Men:"#19D3F3",Women:"#FFA15A"},"User Type":{Daily:"#FF6692",Annual:"#FF97ff"},"Rideable Type":{Unknown:"#636EFA",Electric:"#AB63FA",Classic:"#00CC96"}},q=[["Rides","r"],["Ride minutes","m"],],Q={Rides:{yAxis:"Total Rides",title:"Citi Bike Rides per Month",hoverLabel:"Rides"},"Ride minutes":{yAxis:"Total Ride Minutes",title:"Citi Bike Ride Minutes per Month",hoverLabel:"Minutes"}},I={None:[""],"User Type":["Daily","Annual"],Gender:["Unknown","Women","Men"],"Rideable Type":["Electric","Classic","Unknown"],Region:["JC","HOB","NYC",]},P=t(5152),V=t.n(P),L=t(41664),X=t.n(L);t(10087);var $=V()(function(){return Promise.all([t.e(960),t.e(283)]).then(t.bind(t,58660))},{loadableGenerated:{webpack:function(){return[58660]}},ssr:!1}),K=V()(function(){return t.e(831).then(t.bind(t,25831)).then(function(e){return e.Tooltip})},{loadableGenerated:{webpack:function(){return[25831]}},ssr:!1}),ee=function(e){var n=e.label,t=e.id,r=e.children,a=(0,A.b)();return(0,o.jsxs)("span",{children:[n,(0,o.jsx)("span",{id:t,children:(0,o.jsx)("img",{className:p().warning,alt:"warning icon",src:"".concat(a,"/assets/warning.png")})}),(0,o.jsx)(K,{anchorId:t,className:p().tooltip,children:r})]})},en=function(e){return(0,o.jsxs)(ee,{label:"Gender",id:"gender-label-tooltip-".concat(e),children:[(0,o.jsx)("div",{children:"Gender data no longer published"}),(0,o.jsx)("div",{children:"(as of February 2021)"})]})},et=function(e){return(0,o.jsxs)(ee,{label:"Bike Type",id:"bike-type-label-tooltip-".concat(e),children:[(0,o.jsx)("div",{children:"E-bike data seems to be"}),(0,o.jsx)("div",{children:"mostly missing / undercounted"})]})},er=!0;function ea(e){var n=e.data,t=function(e,n,t){return(0,o.jsx)("a",{href:n,title:t,children:(0,o.jsx)("img",{className:p().icon,alt:t,src:"".concat(ez,"/assets/").concat(e,".png")})})},c={y:(0,U.gO)("Rides",q),u:(0,U.W$)(G,Z,""),s:(0,U.gO)("None",z),pct:U.Yg,r:(0,U.W$)(M,E,""),g:(0,U.W$)(F,H,""),rt:(0,U.W$)(Y,B,""),d:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.defaultValue,t=void 0===n?"All":n,r=e.handleUnexpectedValue,a=void 0===r?"Warn":r,o=d().isEqual;return{encode:function(e){if(!o(e,t)){if("string"==typeof e)return e;var n=e.start,r=e.end;return"".concat(w(n),"-").concat(w(r))}},decode:function(e){if(void 0===e)return t;if(null===e)return function(e,n,t){if("Default"===t)return n;var r="Unexpected value ".concat(e," in decoded query param; returning default ").concat(n);if("Warn"===t)return console.error(r),n;throw Error(r)}(e,"All",a);if(["All","1y","2y","3y","4y","5y",].includes(e))return e;var n,r=(0,i.Z)(e.split("-").map(function(e){return e?j(e):void 0}),2);return{start:r[0],end:r[1]}}}}(),avg:(0,U.wO)([12])},l=(0,U.O5)({params:c}),h=(0,i.Z)(l.y,2),b=h[0],f=h[1],x=(0,i.Z)(l.u,2),g=x[0],y=x[1],_=(0,i.Z)(l.s,2),P=_[0],V=_[1],L=(0,i.Z)(l.pct,2),K=L[0],ee=L[1],er=(0,i.Z)(l.r,2),ea=er[0],ei=er[1],eo=(0,i.Z)(l.g,2),ec=eo[0],es=eo[1],el=(0,i.Z)(l.rt,2),ed=el[0],eu=el[1],eh=(0,i.Z)(l.d,2),ep=eh[0],eb=eh[1],em=(0,i.Z)(l.avg,2),ef=em[0],ex=em[1],eg=(0,u.useState)(!0),ev=eg[0],ey=eg[1],ek=(0,u.useMemo)(function(){return K&&"None"!=P},[P,K]),e_=ek?"%{y:.0%}":"%{y:,.0f}",ew=(0,u.useMemo)(function(){return Q[b]},[b]),ej=ew.hoverLabel,eN=ew.title,eC=(0,u.useMemo)(function(){var e=[];ea&&ea.length<M.length&&e.push("".concat(ea.join("+")));var n="None"==P?void 0:"Rideable Type"==P?"Bike Type":P;return ek&&n?e.push("% by ".concat(n)):ek?e.push("%"):n&&e.push("by ".concat(n)),e.length?"".concat(e.join(", ")):void 0},[ea,ek,P,]),eR=I[P],eA=(0,u.useMemo)(function(){return n.map(function(e){var n=e.Gender,t=e["Rideable Type"],i=(0,a.Z)(e,["Gender","Rideable Type"]);return(0,r.Z)({Gender:O[n],"Rideable Type":S[t]},i)}).filter(function(e){return -1!=ea.indexOf(e.Region)&&-1!=g.indexOf(e["User Type"])&&-1!=ec.indexOf(e.Gender)&&(-1!=ed.indexOf(e["Rideable Type"])||(console.warn("Dropping",e.Count,"rides from with unrecognized rideable type",e["Rideable Type"],e),!1))})},[n,ea,g,ec,ed]),eD={},eT={};eA.forEach(function(e){var n="".concat(e.Year.toString(),"-").concat(e.Month.toString().padStart(2,"0")),t="None"==P?"":e[P],r="Rides"==b?e.Count:e.Duration;n in eD||(eD[n]={});var a=eD[n];t in a||(a[t]=0),a[t]+=r,t in eT||(eT[t]={}),n in(a=eT[t])||(a[n]=0),a[n]+=r}),eT=eR.reduce(function(e,n){return n in eT&&(e[n]=eT[n]),e},{}),eD=(0,T.vm)(eD),eT=(0,T.sq)(eR.filter(function(e){return e in eT}).map(function(e){return[e,(0,T.vm)(eT[e])]}));var eU=(0,T.XP)(eD);if(P&&ek){var eM=(0,T.Q8)(eD,function(e,n){return(0,T.XO)(n)});eD=(0,T.Q8)(eD,function(e,n){return(0,T.Q8)(n,function(n,t){return t/eM[e]})}),eT=(0,T.Q8)(eT,function(e,n){return(0,T.Q8)(n,function(e,n){return n/eM[e]})})}var eE=s()(d().max(n.map(function(e){return new Date(e.Year,e.Month-1)}))).add(1,"d").toDate(),eG=N(ep,eE),eZ=eG.start,eF=eG.end,eH=(0,T.Q8)(eT,function(e,n){return"Gender"==P&&(n=(0,T.Yp)(n,function(e){return new Date(e)<W})),ef.map(function(e){var t,r,a,o,c;return t=n,a=[],o=0,c=[],(0,T.qh)(t).forEach(function(n,t){var r=(0,i.Z)(n,2),s=r[0],l=r[1];if(o+=l,c.push(l),t>=e){var d=c.shift()||NaN;o-=d,a.push([s,o/e,])}else a.push([s,NaN,])}),(0,T.sq)(a)})}),eO=function(e){var n=new Date(e);return eZ<=n&&n<eF},eW=function(){return function(e){return eO(e)}};eU=eU.filter(eO),eT=(0,T.Q8)(eT,function(e,n){return(0,T.H4)(n,eW())}),eD=(0,T.H4)(eD,eW()),eH=(0,T.Q8)(eH,function(e,n){return n.map(function(e){return(0,T.Yp)(e,eO)})});var eY=(0,T.V7)(eT,function(e,n,t){return[e,-t]}),eB=(0,T.zo)((0,T._I)(eH,function(e,n,t){var r=e?"".concat(e," (12mo)"):"12mo avg",a=J[P],i=e?function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return"#"+[e.substring(1,3),e.substring(3,5),e.substring(5,7)].map(function(e){var t;return("0"+(t=Math.round(parseInt(e,16)*n)).toString(16)).substr(-2)}).join("")}(a[e||"Total"],.75):"black";return n.map(function(n){return{name:r,x:(0,T.Wt)((0,T.XP)(n)),y:(0,T.Wt)((0,T.VO)(n)),type:"scatter",marker:{color:i},line:{width:4},hovertemplate:e_,legendrank:101+2*eY[e]}})})),eS=(0,T._I)(eT,function(e,n,t){var r=eU,a=eU.map(function(e){return n[e]||NaN}),i=J[P][e];return{x:r,y:a,name:e||ej,type:"bar",marker:{color:i},hovertemplate:e_,legendrank:100+2*eY[e]}}).concat(eB),ez=(0,A.b)(),eJ="#ddd",eq=null==ev?"None"!=P:ev;return(0,o.jsxs)("div",{id:"plot",className:p().container,children:[(0,o.jsx)(C.Z,{title:eN,description:"Graph of Citi Bike ridership over time",thumbnail:"ctbk-rides"}),(0,o.jsxs)("main",{className:p().main,children:[(0,o.jsxs)("div",{className:p().titleContainer,children:[(0,o.jsx)("h1",{className:p().title,children:eN}),eC&&(0,o.jsx)("p",{className:p().subtitle,children:eC})]}),(0,o.jsx)($,{className:p().plotly,onDoubleClick:function(){return eb("All")},onRelayout:function(e){if("xaxis.range[0]"in e&&"xaxis.range[1]"in e){var n=(0,i.Z)([e["xaxis.range[0]"],e["xaxis.range[1]"],].map(function(e){return e?new Date(e):void 0}),2),t=n[0],r=n[1],a=(t=t?s()(t).subtract(1,"month").toDate():t)||r?{start:t,end:r}:"All";eb(a)}},data:eS,useResizeHandler:!0,layout:{autosize:!0,barmode:"stack",showlegend:eq,hovermode:"x",legend:{x:.5,xanchor:"center",yanchor:"top",orientation:"h",traceorder:"normal"},xaxis:{tickfont:{size:14},titlefont:{size:14},tickformat:"%b '%y",gridcolor:eJ},yaxis:{automargin:!0,gridcolor:eJ,tickfont:{size:14},titlefont:{size:14},tickformat:ek?".0%":void 0,range:ek?[0,1.01,]:void 0},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",margin:{t:0,r:0,b:40,l:0}},config:{displayModeBar:!1}}),(0,o.jsx)("div",{className:p().row,children:(0,o.jsxs)("details",{className:p().controls,children:[(0,o.jsxs)("summary",{children:[(0,o.jsx)("span",{className:p().settingsGear,children:"⚙"}),"️"]}),(0,o.jsxs)("div",{className:"".concat(p().dateControls," ").concat(m().control),children:[(0,o.jsx)("label",{className:m().controlHeader,children:"Dates"}),["1y","2y","3y","4y","5y","All"].map(function(e){return(0,o.jsx)("input",{type:"button",value:e,className:p().dateRangeButton,onClick:function(){return eb(e)},disabled:ep==e},e)})]}),(0,o.jsx)(k,{label:"Region",data:M.map(function(e){return{name:e,data:e,checked:ea.includes(e)}}),cb:ei}),(0,o.jsx)(R,{label:"Stack by",options:["None","Region","User Type",{label:en(1),data:"Gender"},{label:et(1),data:"Rideable Type"},],cb:V,choice:P}),(0,o.jsxs)("div",{className:m().control,children:[(0,o.jsx)(v,{label:"12mo avg",checked:ef.includes(12),cb:function(e){return ex(e?[12]:[])}}),(0,o.jsx)(v,{label:"Legend",checked:eq,cb:ey}),(0,o.jsx)(v,{label:"Stack %",checked:K,cb:ee})]}),(0,o.jsx)(R,{label:"Y Axis",options:["Rides",{label:"Minutes",data:"Ride minutes"}],cb:f,choice:b}),(0,o.jsx)(k,{label:"User Type",data:G.map(function(e){return{name:e,data:e,checked:g.includes(e)}}),cb:y}),(0,o.jsx)(k,{label:en(2),data:[{name:"Men",data:"Men",checked:ec.includes("Men")},{name:"Women",data:"Women",checked:ec.includes("Women")},{name:"Unknown",data:"Unknown",checked:ec.includes("Unknown")},],cb:es}),(0,o.jsx)(k,{label:et(2),data:[{name:"Classic",data:"Classic",checked:ed.includes("Classic")},{name:"Electric",data:"Electric",checked:ed.includes("Electric")},{name:"Unknown",data:"Unknown",checked:ed.includes("Unknown")},],cb:eu})]})}),(0,o.jsx)("hr",{}),(0,o.jsx)("div",{className:"no-gutters row ".concat(p().row),children:(0,o.jsxs)("div",{className:"col-md-12",children:[(0,o.jsx)("p",{children:'Expand the "⚙️" to filter or stack by region, user type, gender, bike type, or date, or toggle aggregation of rides or total ride minutes.'}),(0,o.jsxs)("details",{children:[(0,o.jsx)("summary",{style:{marginBottom:"0.3em"},children:(0,o.jsx)("h4",{style:{display:"inline-block",verticalAlign:"middle",marginBottom:"0.1em"},children:"Examples"})}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:(0,o.jsx)(X(),{href:"/?r=jh&s=r",children:"JC + Hoboken"})}),(0,o.jsxs)("li",{children:[(0,o.jsx)(X(),{href:"/?y=m&s=g&pct=&g=mf&d=1406-2101",children:"Ride minute %'s, Men vs. Women"}),", Jun 2014 – January 2021"]}),(0,o.jsx)("li",{children:(0,o.jsx)(X(),{href:"/?s=u&pct=",children:"Annual vs. daily user %'s"})}),(0,o.jsx)("li",{children:(0,o.jsx)(X(),{href:"/",children:"Default view (system-wide rides over time)"})})]})]}),(0,o.jsxs)("p",{children:["This plot should refresh when ",(0,o.jsx)("a",{href:"https://www.citibikenyc.com/system-data",children:"new data is published by Citibike"})," (typically around the 2nd week of each month, covering the previous month)."]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("a",{href:"https://github.com/neighbor-ryan/ctbk.dev",children:"The GitHub repo"})," has more info as well as ",(0,o.jsx)("a",{href:"https://github.com/neighbor-ryan/ctbk.dev/issues",children:"planned enhancements"}),"."]}),(0,o.jsxs)("p",{children:["Also, check out ",(0,o.jsx)(X(),{href:"./stations",children:"this map visualization of stations and their ridership counts in August 2022"}),"."]}),(0,o.jsx)("h3",{id:"qc",children:"\uD83D\uDEA7 Data-quality issues \uD83D\uDEA7"}),(0,D.ZP)('\nSeveral things changed in February 2021 (presumably as part of [the Lyft acquistion](https://www.lyft.com/blog/posts/lyft-becomes-americas-largest-bikeshare-service)):\n- "Gender" information no longer provided (all rides labeled "unknown" starting February 2021)\n- A new "Rideable Type" field was added, containing values `docked_bike` and `electric_bike` \uD83C\uDF89; however, it is mostly incorrect at present, and disabled above:\n  - Prior to February 2021, the field is absent (even though e-citibikes were in widespread use before then)\n  - Since February 2021, only a tiny number of rides are labeled `electric_bike` (122 in April 2021, 148 in May, 113 in June); this is certainly not accurate!\n    - One possible explanation: [electric citibikes were launched in Jersey City and Hoboken around April 2021](https://www.hobokengirl.com/hoboken-jersey-city-citi-bike-share-program/); perhaps those bikes were part of a new fleet that show up as `electric_bike` in the data (while extant NYC e-citibikes don\'t).\n    - These `electric_bike` rides showed up in the default ("NYC") data, not the "JC" data, but it could be all in flux; February through April 2021 were also updated when the May 2021 data release happened in early June.\n- The "User Type" values changed ("Annual" → "member", "Daily" → "casual"); I\'m using the former/old values here, they seem equivalent.\n                    '),(0,o.jsxs)("div",{className:p().footer,children:["Code: ",t("gh","https://github.com/neighbor-ryan/ctbk.dev#readme","GitHub logo"),"Data: ",t("s3","https://s3.amazonaws.com/ctbk/index.html","Amazon S3 logo"),"Author: ",t("twitter","https://twitter.com/RunsAsCoded","Twitter logo")]})]})})]})]})}},8974:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(85893);t(67294);var a=t(78855),i="https://ctbk.dev",o="".concat(i,"/screenshots");function c(e){var n=e.title,t=e.description,c=e.path,s=e.thumbnail;return(0,r.jsxs)(a.F,{title:n,description:t,url:"".concat(i,"/").concat(c||""),thumbnail:"".concat(o,"/").concat(s,".png"),children:[(0,r.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,r.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,r.jsx)("meta",{property:"og:site_name",content:"ctbk.dev"},"ogsitename")]})}},50636:function(){},95408:function(e){e.exports={container:"index_container__Xi8tY",row:"index_row__6VrNw",button:"index_button__g8ljY",main:"index_main__3wZvj",titleContainer:"index_titleContainer__OGED6",title:"index_title__RIjyU",subtitle:"index_subtitle__7ZcxE",controls:"index_controls__KdiaJ",settingsGear:"index_settingsGear__GmMwD",plotSection:"index_plotSection__qdLGq",plotChildren:"index_plotChildren__UH_18",mid:"index_mid__xHhVU",warning:"index_warning__vb4p2",tooltip:"index_tooltip__Mg2W_",dateControls:"index_dateControls__ngyNj","date-range":"index_date-range__F6Zp8",dateRangeButton:"index_dateRangeButton__bG82_",plotly:"index_plotly__UNxAh",footer:"index_footer__JKxwI",icon:"index_icon__CgRrC"}},57639:function(e){e.exports={control:"controls_control__HMu3o",nowrap:"controls_nowrap__QtWwW",controlHeader:"controls_controlHeader__esdEV",subControl:"controls_subControl__ud5NN",checkbox:"controls_checkbox__9tzHR"}}},function(e){e.O(0,[662,885,171,995,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);