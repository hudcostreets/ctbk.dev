(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{97434:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stations",function(){return e(14923)}])},14923:function(t,n,e){"use strict";e.r(n),e.d(n,{MAPS:function(){return b},__N_SSG:function(){return j},default:function(){return M},ymParam:function(){return k}});var o=e(828),a=e(29815),r=e(85893),i=e(16652),s=e(5152),c=e.n(s)()((function(){return Promise.all([e.e(269),e.e(685)]).then(e.bind(e,38685))}),{loadableGenerated:{webpack:function(){return[38685]}},ssr:!1}),u=e(23023),l=e(67294),d=e(45553),m=e.n(d),f=e(83300),p=e.n(f),h=e(96486),g=e.n(h),_={lat:40.758,lng:-73.965},v=Object.entries,y=Object.fromEntries,x=Math.sqrt,j=!0,b={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}};function w(t,n){var e=t.TileLayer,i=(t.Marker,t.Circle),s=(t.CircleMarker,t.Polyline),c=t.Pane,u=t.Tooltip,d=t.useMapEvents,f=t.useMap,p=n.setLL,h=n.setZoom,g=n.stations,_=n.stationCounts,y=n.selectedStation,j=n.setSelectedStation,b=n.stationPairCounts,w=n.url,k=n.attribution,M=function(t){var n=t.id,e=t.count,o=t.selected,a=g[n],s=a.name,c=a.lat,l=a.lng;return(0,r.jsx)(i,{center:{lat:c,lng:l},color:o?"yellow":"orange",radius:x(e),eventHandlers:{click:function(){n!=y&&(console.log("click:",s),j(n))},mouseover:function(){n!=y&&(console.log("over:",s),j(n))},mousedown:function(){n!=y&&(console.log("down:",s),j(n))}},children:(0,r.jsxs)(u,{sticky:!0,children:[s,": ",e]})},n)},C=f(),S=C.getZoom(),Z=(0,l.useMemo)((function(){return function(t){var n=t.getCenter(),e=t.latLngToContainerPoint(n),o=[e.x+1,e.y],a=t.containerPointToLatLng(e),r=t.containerPointToLatLng(o);return a.distanceTo(r)}(C)}),[C,S]);d({moveend:function(){return p(C.getCenter())},zoom:function(){return h(C.getZoom())},click:function(){j(void 0)}});var N=(0,l.useMemo)((function(){var t;if(!y||!b)return null;var n=b[y],e=Array.from(Object.values(n)),i=(t=Math).max.apply(t,(0,a.Z)(e)),l=_[y],d=g[y];return(0,r.jsx)(c,{name:"lines",className:m().lines,children:v(n).map((function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1];if(e in g){var c=g[e],m=c.name,f=c.lat,p=c.lng;return(0,r.jsx)(s,{color:"red",positions:[[d.lat,d.lng],[f,p]],weight:Math.max(.7,a/i*x(l)/Z),opacity:.7,children:(0,r.jsxs)(u,{sticky:!0,children:[d.name," \u2192 ",m,": ",a]})},"".concat(y,"-").concat(e,"-").concat(S))}console.log("id ".concat(e," not in stations:"),g)}))})}),[b,y,_,Z]),P=y?Array.from(v(_).filter((function(t){var n=(0,o.Z)(t,2),e=n[0];n[1];return e==y})))[0]:void 0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{name:"selected",className:m().selected,children:P&&[P].map((function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1];return(0,r.jsx)(M,{id:e,count:a,selected:!0},e)}))}),N,(0,r.jsx)(c,{name:"circles",className:m().circles,children:v(_).map((function(t){var n=(0,o.Z)(t,2),e=n[0],a=n[1];return(0,r.jsx)(M,{id:e,count:a},e)}))}),(0,r.jsx)(e,{url:w,attribution:k})]})}function k(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=/^20(\d{4})$/,o=/^\d{4}$/;return{encode:function(n){if(n!=t){var o=n.match(e);return o?o[1]:void console.warn("Invalid ym param: ".concat(n))}},decode:function(n){return n?n.match(o)?"20".concat(n):(console.warn("Invalid ym param value: ".concat(n)),t):t},push:n}}function M(t){var n=t.defaults,e=t.stations,a={ll:(0,u.GS)({init:_,places:3}),z:(0,u.yc)(12,!1),ss:(0,u.ON)(),ym:k(n.ym)},s=(0,u.O5)({params:a}),d=(0,o.Z)(s.ll,2),f=d[0],h=f.lat,x=f.lng,j=d[1],M=(0,o.Z)(s.z,2),C=M[0],S=M[1],Z=(0,o.Z)(s.ss,2),N=Z[0],P=Z[1],L=(0,o.Z)(s.ym,2),O=L[0],T=(L[1],(0,l.useState)(n.stationCounts)),z=T[0],E=T[1],q=(0,l.useState)(null),A=q[0],R=q[1],H=(0,l.useMemo)((function(){var t,e=parseInt(O.substring(0,4)),a=parseInt(O.substring(4)),r=new Date(e,a-1).toLocaleDateString("default",{month:"short",year:"numeric"}),i="https://ctbk.s3.amazonaws.com/aggregated/".concat(O),s="".concat(i,"/idx2id.json"),c="".concat(i,"/s_c.json"),u="".concat(i,"/se_c.json");return O==n.ym?(E(n.stationCounts),t=Promise.resolve(n.idx2id),console.log("Setting stationCounts to default")):(console.log("fetching ".concat(c)),t=p()(s).then((function(t){return t.json()})).then((function(t){return console.log("got idx2id"),t})),p()(c).then((function(t){return t.json()})).then((function(n){return t.then((function(t){console.log("got stationCounts"),E(g().mapKeys(n,(function(n,e){return t[e]})))}))}))),console.log("fetching ".concat(u)),p()(u).then((function(t){return t.json()})).then((function(n){return t.then((function(t){console.log("got stationPairCounts"),R(y(v(n).map((function(n){var e=(0,o.Z)(n,2),a=e[0],r=e[1];return[t[a],g().mapKeys(r,(function(n,e){return t[e]}))]}))))}))})),{ymString:r}}),[O]).ymString,I="Citi Bike rides by station, ".concat(H),D=b.alidade_smooth_dark,F=D.url,G=D.attribution;return(0,r.jsxs)("div",{className:m().container,children:[(0,r.jsx)(i.Z,{title:I,description:"Map of Citi Bike stations, including ridership counts and frequent destinations",path:"stations",thumbnail:"ctbk-stations"}),(0,r.jsxs)("main",{className:m().main,children:[(0,r.jsx)(c,{className:m().homeMap,center:{lat:h,lng:x},zoom:C,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,children:function(t){return(0,r.jsx)("div",{children:w(t,{setLL:j,setZoom:S,stations:e,stationCounts:z,selectedStation:N,setSelectedStation:P,stationPairCounts:A,url:F,attribution:G})})}}),I&&(0,r.jsx)("div",{className:m().title,children:I})]})]})}},16652:function(t,n,e){"use strict";e.d(n,{Z:function(){return s}});var o=e(85893),a=(e(67294),e(37581)),r="https://ctbk.dev",i="".concat(r,"/screenshots");function s(t){var n=t.title,e=t.description,s=t.path,c=t.thumbnail;return(0,o.jsxs)(a.F,{title:n,description:e,url:"".concat(r,"/").concat(s||""),thumbnail:"".concat(i,"/").concat(c,".png"),children:[(0,o.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,o.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,o.jsx)("meta",{property:"og:site_name",content:"ctbk.dev"},"ogsitename")]})}},45553:function(t){t.exports={container:"stations_container__Z0llF",main:"stations_main__xJuAQ",title:"stations_title__Lq0Hh",homeMap:"stations_homeMap__Ms8dh",selected:"stations_selected__AMT5f",circles:"stations_circles__T0Q2o",lines:"stations_lines__8OJmu"}},83300:function(t,n){"use strict";var e=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw new Error("unable to locate global object")}();t.exports=n=e.fetch,e.fetch&&(n.default=e.fetch.bind(e)),n.Headers=e.Headers,n.Request=e.Request,n.Response=e.Response}},function(t){t.O(0,[662,839,774,888,179],(function(){return n=97434,t(t.s=n);var n}));var n=t.O();_N_E=n}]);