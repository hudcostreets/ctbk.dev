(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7631)}])},7631:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return ue},default:function(){return de}});var r=t(41799),a=t(99534),i=t(828),o=t(29815),c=t(85893),s=t(67294),l=t(28781),u=t(5152),d=t.n(u),h=Object.fromEntries;function f(e){var n=e.label,t=e.data,a=e.cb,i=e.children,o=h(t.map((function(e){return[e.name,{data:e.data,checked:e.checked||!1}]}))),s=t.map((function(e){var n=e.name,t=e.disabled,r=o[n].checked;return(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"checkbox",name:n,value:n,checked:r,disabled:t,onChange:function(){}}),n]},n)}));return(0,c.jsxs)("div",{className:"control col",children:[(0,c.jsxs)("div",{className:"control-header",children:[n,":"]}),(0,c.jsx)("div",{onChange:function(e){var n=e.target.value,t=e.target.checked,i=o[n],c=i.checked,s=i.data;if(c==t)console.warn("Checkbox",n,"already has value",t);else{var l=(0,r.Z)({},o);l[n]={data:s,checked:t};var u=Object.keys(l).filter((function(e){return l[e].checked})).map((function(e){return l[e].data}));a(u)}},className:"sub-control",children:s}),i]})}function b(e){var n=e.label,t=e.options,r=e.choice,a=e.cb,i=e.children,o=t.map((function(e){var t="string"===typeof e?{label:e,data:e,disabled:!1}:e,a=t.label,i=t.data,o=t.disabled;return(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"radio",name:n+"-"+i,value:i,checked:i==r,disabled:o,onChange:function(e){}}),a]},i)}));return(0,c.jsxs)("div",{className:"control col",children:[(0,c.jsxs)("div",{className:"control-header",children:[n,":"]}),(0,c.jsx)("div",{id:n,className:"sub-control",onChange:function(e){return a(e.target.value)},children:o}),i]})}var p=t(51438),m=t(88029),g=t(16567),v=function(e){(0,m.Z)(t,e);var n=(0,g.Z)(t);function t(){return(0,p.Z)(this,t),n.apply(this,arguments)}return t.prototype.render=function(){var e=this.props,n=e.id,t=e.label,r=e.checked,a=e.cb;return(0,c.jsx)("div",{id:n,className:"sub-control",children:(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return a(e.target.checked)}}),t]})})},t}(s.Component),y=t(30381),x=t.n(y),k=t(96486),w=t.n(k),j=t(23023),C=t(18048);function N(e,n,t){if("Default"===t)return n;var r="Unexpected value ".concat(e," in decoded query param; returning default ").concat(n);if("Warn"===t)return console.error(r),n;throw new Error(r)}var D=x()("2013-06-01").toDate(),R=function(e){return e?x()(e).format("YYMM"):""},Z=function(e){var n="20".concat(e.substring(0,2)),t=e.substring(2,4);return x()("".concat(n,"-").concat(t,"-01")).toDate()};function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.defaultValue,t=void 0===n?"All":n,r=e.handleUnexpectedValue,a=void 0===r?"Warn":r,o=w().isEqual;return{encode:function(e){if(!o(e,t)){if("string"===typeof e)return e;var n=e.start,r=e.end;return"".concat(R(n),"-").concat(R(r))}},decode:function(e){if(void 0===e)return t;if(null===e)return N(e,"All",a);if(["All","1y","2y","3y","4y","5y"].includes(e))return e;var n=(0,i.Z)(e.split("-").map((function(e){return e?Z(e):void 0})),2);return{start:n[0],end:n[1]}}}}var T=t(41664),_=t.n(T),O=t(16652),U=l.D,M=d()((function(){return t.e(762).then(t.bind(t,24762))}),{loadableGenerated:{webpack:function(){return[24762]}},ssr:!1}),E=d()((function(){return Promise.all([t.e(960),t.e(660)]).then(t.bind(t,58660))}),{loadableGenerated:{webpack:function(){return[58660]}},ssr:!1}),F=Object.entries,G=Object.values,S=Object.keys,Y=Object.fromEntries,J=Array.from,z=["NYC","JC","HB"],H=[["HB","h"],["NYC","n"],["JC","j"]],B={NYC:"NYC",JC:"JC",HB:"HOB"},q=[["All","a"],["Subscriber","s"],["Customer","c"]],L=["Male","Female","Other / Unspecified"],P=[["Male","m"],["Female","f"],["Other / Unspecified","u"]],W={0:"Other / Unspecified",1:"Male",2:"Female"},I=new Date("2021-02-01"),$=["Docked","Electric","Unknown"],V=[["Docked","d"],["Electric","e"],["Unknown","u"]],X={docked_bike:"Docked",classic_bike:"Docked",electric_bike:"Electric",unknown:"Unknown",motivate_dockless_bike:"Unknown"},K=[["None","n"],["Region","r"],["Gender","g"],["User Type","u"],["Rideable Type","b"]],Q=[["Rides","r"],["Ride minutes","m"]],ee={Rides:{yAxis:"Total Rides",title:"Citibike Rides per Month",hoverLabel:"Rides"},"Ride minutes":{yAxis:"Total Ride Minutes",title:"Citibike Ride Minutes per Month",hoverLabel:"Minutes"}};function ne(e){return S(e).sort().reduce((function(n,t){return n[t]=e[t],n}),{})}function te(e){return G(e).reduce((function(e,n){return e+n}),0)}function re(e,n){return function(e,n){return Y(F(e).map((function(e){var t=(0,i.Z)(e,2),r=t[0],a=t[1];return n(r,a)})))}(e,(function(e,t){return[e,n(e,t)]}))}function ae(e,n){return Y(F(e).filter((function(e){var t=(0,i.Z)(e,2),r=t[0],a=t[1];return n(r,a)})))}function ie(e,n,t){for(var r=[],a=t?function(e){return t(e)}:function(e){return e},i=0,o=0;o<e.length;o++)if(i+=a(e[o]),o>=n){var c=(i-=a(e[o-n]))/n;r.push([e[o],c])}else r.push([e[o],null]);return r}var oe={1:[1],2:[.75,1],3:[.65,.8,1]},ce={None:{"":"0"},Region:{NYC:"6",HB:"D",JC:"E"},"User Type":{Customer:"D",Subscriber:"7"},Gender:{Male:"6",Female:"D","Other / Unspecified":"E"},"Rideable Type":{Docked:"E",Electric:"D",Unknown:"6"}};function se(e,n){return("0"+e.toString(16)).substr(-n)}function le(e){var n="".concat(e-1,"-12-20");return{layer:"below",type:"line",x0:n,y0:0,x1:n,yref:"paper",y1:1,line:{color:"#555555"}}}var ue=!0;function de(e){var n,t=e.data,l=function(e,n,t){return(0,c.jsx)("a",{href:n,title:t,children:(0,c.jsx)("img",{className:"icon",alt:t,src:"".concat(tn,"/assets/").concat(e,".png")})})},u={y:(0,j.gO)("Rides",Q),u:(0,j.gO)("All",q),s:(0,j.gO)("None",K),pct:j.Yg,r:(0,j.W$)(z,H,""),g:(0,j.W$)(L,P,""),rt:(0,j.W$)($,V,""),d:A(),rolling:(0,j.wO)([12])},d=(0,j.O5)({params:u}),h=(0,i.Z)(d.y,2),p=h[0],m=h[1],g=(0,i.Z)(d.u,2),y=g[0],k=g[1],N=(0,i.Z)(d.s,2),R=N[0],Z=N[1],T=(0,i.Z)(d.pct,2),ue=T[0],de=T[1],he=(0,i.Z)(d.r,2),fe=he[0],be=he[1],pe=(0,i.Z)(d.g,2),me=pe[0],ge=pe[1],ve=(0,i.Z)(d.rt,2),ye=ve[0],xe=(ve[1],(0,i.Z)(d.d,2)),ke=xe[0],we=xe[1],je=(0,i.Z)(d.rolling,2),Ce=je[0],Ne=je[1],De=(0,s.useState)(!0),Re=De[0],Ze=De[1],Ae=ee[p].yAxis,Te=ee[p].hoverLabel,_e=ee[p].title,Oe=[];fe&&fe.length<z.length&&Oe.push("".concat(fe.map((function(e){return B[e]})).join(", "))),ue&&(Ae+=" (%)",Te+=" (%)",Oe.push("%, by ".concat(R))),Oe.length&&(_e+=" (".concat(Oe.join(";"),")"));var Ue=t.map((function(e){var n=e.Gender,t=e["Rideable Type"],i=(0,a.Z)(e,["Gender","Rideable Type"]);return(0,r.Z)({Gender:W[n],"Rideable Type":X[t]},i)})).filter((function(e){return-1!=fe.indexOf(e.Region)&&(("All"==y||y==e["User Type"])&&(-1!=me.indexOf(e.Gender)&&(-1!=ye.indexOf(e["Rideable Type"])||(console.warn("Dropping",e.Count,"rides from with unrecognized rideable type",e["Rideable Type"],e),!1))))})),Me={None:[""],"User Type":["Customer","Subscriber"],Gender:["Other / Unspecified","Male","Female"],"Rideable Type":["Docked","Electric","Unknown"],Region:["JC","HB","NYC"]}[R],Ee=null==Re?"None"!=R:Re,Fe={},Ge={};Ue.forEach((function(e){var n="".concat(e.Year.toString(),"-").concat(e.Month.toString().padStart(2,"0")),t="None"==R?"":e[R],r="Rides"==p?e.Count:e.Duration;n in Fe||(Fe[n]={});var a=Fe[n];t in a||(a[t]=0),a[t]+=r,t in Ge||(Ge[t]={}),n in(a=Ge[t])||(a[n]=0),a[n]+=r})),Fe=ne(Fe),Ge=Y(Me.map((function(e){return[e,ne(Ge[e]||{})]})));var Se=J(S(Fe));if(R&&ue){var Ye=re(Fe,(function(e,n){return te(n)}));Fe=re(Fe,(function(e,n){return re(n,(function(n,t){return t/Ye[e]*100}))})),Ge=re(Ge,(function(e,n){return re(n,(function(e,n){return n/Ye[e]*100}))}))}var Je=x()(w().max(t.map((function(e){return new Date(e.Year,e.Month-1)})))).add(1,"d").toDate(),ze=function(e,n){if(n=n||new Date,"All"==e)return{start:D,end:n};if("string"===typeof e){var t=new Date(n);if("y"!=e[e.length-1])throw Error("Unrecognized date range string: ".concat(e));var r=parseInt(e.substr(0,e.length-1));return t.setFullYear(t.getFullYear()-r),console.log("subtracted ".concat(r," years: ").concat(t,", ").concat(n)),{start:t,end:n}}var a=e.start,i=e.end;return{start:a||D,end:i||n}}(ke,Je),He=ze.start,Be=ze.end,qe=[];if(qe=(n=qe).concat.apply(n,(0,o.Z)(G(Ge).map((function(e){var n=F(e).map((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];return{month:new Date(t),v:r}}));return"Gender"==R&&(n=n.filter((function(e){return e.month<I}))),Ce.map((function(e){return ie(n,e,(function(e){return e.v})).filter((function(e){var n=(0,i.Z)(e,2),t=n[0].month;n[1];return He<=t&&t<Be})).map((function(e){var n=(0,i.Z)(e,2);n[0];return n[1]}))}))})))),"None"!=R&&!ue){var Le=F(Fe).map((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];return{month:new Date(t),total:te(r)}})),Pe=Ce.map((function(e){return ie(Le,e,(function(e){return e.total})).filter((function(e){var n=(0,i.Z)(e,2),t=n[0].month;n[1];return He<=t&&t<Be})).map((function(e){var n=(0,i.Z)(e,2);n[0];return n[1]}))}));qe=qe.concat(Pe)}var We=function(e){var n=new Date(e);return He<=n&&n<Be},Ie=function(){return function(e,n){return We(e)}};Se=Se.filter(We),Ge=re(Ge,(function(e,n){return ae(n,Ie())})),Fe=ae(Fe,Ie());var $e=Se.map((function(e){return new Date(e)})).filter((function(e){return 0==e.getMonth()})).map((function(e){return e.getFullYear()})),Ve=(0,o.Z)(new Set($e)).map(le),Xe=ce[R];Xe.Total="0";var Ke=qe.map((function(e,n){var t=Me[n]||"Total",r="Total"==t?"12mo avg":"".concat(t," (12mo)"),a=Xe[t];return{name:r,x:Se,y:e,type:"scatter",marker:{color:"#"+a+a+a+a+a+a},line:{width:4}}})),Qe=oe[Me.length],en=F(Ge).map((function(e,n){var t=(0,i.Z)(e,2),r=t[0],a=t[1],o=Se,c=Se.map((function(e){return a[e]||0})),s=r||Te,l=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return"#"+[e.substring(1,3),e.substring(3,5),e.substring(5,7)].map((function(e){return se(Math.round(parseInt(e,16)*n),2)})).join("")}("#88aaff",Qe[n]);return{x:o,y:c,name:s,type:"bar",marker:{color:l}}})),nn=en.concat(Ke),tn=(0,C.b)(),rn=(0,c.jsxs)("span",{children:["Gender",(0,c.jsx)("span",{"data-tip":!0,"data-for":"gender-label-tooltip",children:(0,c.jsx)("img",{className:"warning icon",alt:"warning icon",src:"".concat(tn,"/assets/warning.png")})})]}),an={titlefont:{size:18},autosize:!0,barmode:"stack",showlegend:Ee,legend:{x:.5,y:1.12,xanchor:"center",orientation:"h"},title:_e,xaxis:{title:"Month",tickfont:{size:14},titlefont:{size:14}},yaxis:{automargin:!0,gridcolor:"#DDDDDD",title:{text:Ae},tickfont:{size:14},titlefont:{size:14},range:ue?[0,100]:void 0},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",shapes:Ve,margin:{b:40,l:20,r:10}};return(0,c.jsxs)("div",{id:"plot",className:"container",children:[(0,c.jsx)(O.Z,{title:_e,description:"Graph of Citi Bike ridership over time",thumbnail:"ctbk-rides"}),(0,c.jsx)(E,{onDoubleClick:function(){return we("All")},onRelayout:function(e){if("xaxis.range[0]"in e&&"xaxis.range[1]"in e){var n=(0,i.Z)([e["xaxis.range[0]"],e["xaxis.range[1]"]].map((function(e){return e?new Date(e):void 0})),2),t=n[0],r=n[1];t=t?x()(t).subtract(1,"month").toDate():t,we(t||r?{start:t,end:r}:"All")}},data:nn,useResizeHandler:!0,layout:an}),(0,c.jsx)("div",{className:"no-gutters row date-controls",children:(0,c.jsx)("div",{className:"col-6",children:["1y","2y","3y","4y","5y","All"].map((function(e){return(0,c.jsx)("input",{type:"button",value:e,className:"date-range-button",onClick:function(){return we(e)},disabled:ke==e},e)}))})}),(0,c.jsxs)("div",{className:"no-gutters row",children:[(0,c.jsx)(f,{label:"Region",data:z.map((function(e){return{name:B[e],data:e,checked:fe.includes(e)}})),cb:be}),(0,c.jsx)(b,{label:"User Type",options:["All","Subscriber","Customer"],cb:k,choice:y}),(0,c.jsx)(b,{label:"Y Axis",options:["Rides","Ride minutes"],cb:m,choice:p}),(0,c.jsx)(f,{label:"Rolling Avg",data:[{name:"12mo",data:12,checked:Ce.includes(12)}],cb:Ne,children:(0,c.jsx)(v,{id:"showlegend",label:"Legend",checked:Ee,cb:Ze})}),(0,c.jsx)(b,{label:"Stack by",options:["None","Region","User Type",{label:rn,data:"Gender"}],cb:Z,choice:R,children:(0,c.jsx)(v,{id:"stack-relative",label:"Percentages",checked:ue,cb:de})}),(0,c.jsx)(f,{label:rn,data:[{name:"Male",data:"Male",checked:me.includes("Male")},{name:"Female",data:"Female",checked:me.includes("Female")},{name:"Other / Unspecified",data:"Other / Unspecified",checked:me.includes("Other / Unspecified")}],cb:ge}),(0,c.jsxs)(M,{id:"gender-label-tooltip",className:"label-tooltip",children:[(0,c.jsx)("div",{children:"Gender data no longer published"}),(0,c.jsx)("div",{children:"(as of February 2021)"})]})]}),(0,c.jsx)("div",{className:"no-gutters row",children:(0,c.jsxs)("div",{className:"col-md-12",children:[(0,c.jsx)("h2",{children:"About"}),(0,c.jsx)("p",{children:"Use the controls above to filter/stack by region, user type, gender, or date, and toggle aggregation of rides or total ride minutes, e.g.:"}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:(0,c.jsx)(_(),{href:"/?r=jh",children:"JC+Hoboken"})}),(0,c.jsxs)("li",{children:[(0,c.jsx)(_(),{href:"/?y=m&s=g&pct=&g=mf&d=1406-2101",children:"Ride minute %'s, Male vs. Female"})," (Jun 2014 - January 2021, the window where 12mo rolling avgs are possible)"]})]}),(0,c.jsxs)("p",{children:["This plot should refresh when ",(0,c.jsx)("a",{href:"https://www.citibikenyc.com/system-data",children:"new data is published by Citibike"})," (typically around the 2nd week of each month, covering the previous month)."]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("a",{href:"https://github.com/neighbor-ryan/ctbk.dev",children:"The GitHub repo"})," has more info as well as ",(0,c.jsx)("a",{href:"https://github.com/neighbor-ryan/ctbk.dev/issues",children:"planned enhancements"}),"."]}),(0,c.jsxs)("p",{children:["Also, check out ",(0,c.jsx)(_(),{href:"./stations",children:"this map visualization of stations and their ridership counts in August 2022"}),"."]}),(0,c.jsx)("h3",{id:"qc",children:"\ud83d\udea7 Data-quality issues \ud83d\udea7"}),(0,c.jsx)(U,{children:'\nSeveral things changed in February 2021 (presumably as part of [the Lyft acquistion](https://www.lyft.com/blog/posts/lyft-becomes-americas-largest-bikeshare-service)):\n- "Gender" information no longer provided (all rides labeled "unknown" starting February 2021)\n- A new "Rideable Type" field was added, containing values `docked_bike` and `electric_bike` \ud83c\udf89; however, it is mostly incorrect at present, and disabled above:\n  - Prior to February 2021, the field is absent (even though e-citibikes were in widespread use before then)\n  - Since February 2021, only a tiny number of rides are labeled `electric_bike` (122 in April 2021, 148 in May, 113 in June); this is certainly not accurate!\n    - One possible explanation: [electric citibikes were launched in Jersey City and Hoboken around April 2021](https://www.hobokengirl.com/hoboken-jersey-city-citi-bike-share-program/); perhaps those bikes were part of a new fleet that show up as `electric_bike` in the data (while extant NYC e-citibikes don\'t).\n    - These `electric_bike` rides showed up in the default ("NYC") data, not the "JC" data, but it could be all in flux; February through April 2021 were also updated when the May 2021 data release happened in early June.\n- The "User Type" values changed ("Subscriber" \u2192 "member", "Customer" \u2192 "casual"); I\'m using the former/old values here, they seem equivalent.\n                    '}),(0,c.jsxs)("div",{className:"footer",children:["Code: ",l("gh","https://github.com/neighbor-ryan/ctbk.dev#readme","GitHub logo"),"Data: ",l("s3","https://s3.amazonaws.com/ctbk/index.html","Amazon S3 logo"),"Author: ",l("twitter","https://twitter.com/RunsAsCoded","Twitter logo")]})]})})]})}},16652:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(85893),a=(t(67294),t(37581)),i="https://ctbk.dev",o="".concat(i,"/screenshots");function c(e){var n=e.title,t=e.description,c=e.path,s=e.thumbnail;return(0,r.jsxs)(a.F,{title:n,description:t,url:"".concat(i,"/").concat(c||""),thumbnail:"".concat(o,"/").concat(s,".png"),children:[(0,r.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,r.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,r.jsx)("meta",{property:"og:site_name",content:"ctbk.dev"},"ogsitename")]})}}},function(e){e.O(0,[662,885,839,611,774,888,179],(function(){return n=48312,e(e.s=n);var n}));var n=e.O();_N_E=n}]);