"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[652],{9652:function(e,t,n){n.r(t),n.d(t,{MapBody:function(){return X},default:function(){return $}});var r,o,l,u=n(11527),a=n(89136),i=n(50959);function c(e,t){return Object.freeze({...e,...t})}let s=(0,i.createContext)(null),f=s.Provider;function p(){let e=(0,i.useContext)(s);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var d=n(3852);function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let h=(0,i.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:o,id:l,placeholder:u,style:a,whenReady:c,zoom:s,...p},h){let[v]=(0,i.useState)({className:o,id:l,style:a}),[y,g]=(0,i.useState)(null);(0,i.useImperativeHandle)(h,()=>y?.map??null,[y]);let b=(0,i.useCallback)(r=>{if(null!==r&&null===y){let o=new d.Map(r,p);null!=n&&null!=s?o.setView(n,s):null!=e&&o.fitBounds(e,t),null!=c&&o.whenReady(c),g(Object.freeze({__version:1,map:o}))}},[]);(0,i.useEffect)(()=>()=>{y?.map.remove()},[y]);let E=y?i.createElement(f,{value:y},r):u??null;return i.createElement("div",m({},v,{ref:b}),E)});function v(){return p().map}function y({setCenter:e,setZoom:t,onClick:n,children:r}){let o=v();return!function(e){let t=v();(0,i.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e])}({click:e=>{console.log("leaflet click:",e),n&&n(e)},moveend:()=>e(o.getCenter()),zoom:()=>t(o.getZoom())}),i.createElement(i.Fragment,null,r)}var g=n(10422);function b(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function E(e,t){return null==t?function(t,n){let r=(0,i.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let o=(0,i.useRef)();o.current||(o.current=e(n,r));let l=(0,i.useRef)(n),{instance:u}=o.current;return(0,i.useEffect)(function(){l.current!==n&&(t(u,n,l.current),l.current=n)},[u,n,r]),o}}function x(e,t){let n=(0,i.useRef)(t);(0,i.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function j(e,t){let n=(0,i.useRef)();(0,i.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function w(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function C(e,t){(0,i.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function _(e,t){var n,r;return n=E(e,t),r=function(e){let t=p(),r=n(w(e,t),t);return j(r.current,e.eventHandlers),C(r.current,t),function(e,t){let n=(0,i.useRef)();(0,i.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(r.current,e),r},(0,i.forwardRef)(function(e,t){let{instance:n,context:o}=r(e).current;return(0,i.useImperativeHandle)(t,()=>n),null==e.children?null:i.createElement(f,{value:o},e.children)})}function P(e,t){var n,r;return n=E(e,t),r=function(e){let t=p(),r=n(w(e,t),t);return x(t.map,e.attribution),j(r.current,e.eventHandlers),C(r.current,t),r},(0,i.forwardRef)(function(e,t){let{instance:n}=r(e).current;return(0,i.useImperativeHandle)(t,()=>n),null})}function k(e,t,n){let{opacity:r,zIndex:o}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=o&&o!==n.zIndex&&e.setZIndex(o)}let L=P(function({url:e,...t},n){return b(new d.TileLayer(e,w(t,n)),n)},function(e,t,n){k(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}),O={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}},M=P(function({url:e,...t},n){return b(new d.TileLayer(e,w(t,n)),n)},function(e,t,n){k(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)});function R({map:e="alidade_smooth_dark",edgeBufferTiles:t,...n}){let{url:r,attribution:o}=O[e];return t?i.createElement(M,{url:r,attribution:o,...n}):i.createElement(L,{url:r,attribution:o,...n})}function T({map:e="alidade_smooth_dark",edgeBufferTiles:t,setCenter:n,setZoom:r,tolerance:o=12,padding:l=.5,onClick:u,children:a,...c}){let s=(0,i.useMemo)(()=>d.canvas({tolerance:o,padding:l}),[o,l]);return i.createElement(h,{...c,renderer:s},i.createElement(y,{setCenter:n,setZoom:r,onClick:u},i.createElement(R,{map:e,edgeBufferTiles:t}),a))}let N=["mapPane","markerPane","overlayPane","popupPane","shadowPane","tilePane","tooltipPane"];function H(e,t){let{[t]:n,...r}=e;return r}let S=(0,i.forwardRef)(function(e,t){let[n]=(0,i.useState)(e.name),[r,o]=(0,i.useState)(null);(0,i.useImperativeHandle)(t,()=>r,[r]);let l=p(),u=(0,i.useMemo)(()=>({...l,pane:n}),[l]);return(0,i.useEffect)(()=>(o(function(e,t,n){if(-1!==N.indexOf(e))throw Error(`You must use a unique name for a pane that is not a default Leaflet pane: ${e}`);if(null!=n.map.getPane(e))throw Error(`A pane with this name already exists: ${e}`);let r=t.pane??n.pane,o=r?n.map.getPane(r):void 0,l=n.map.createPane(e,o);return null!=t.className&&function(e,t){t.split(" ").filter(Boolean).forEach(t=>{d.DomUtil.addClass(e,t)})}(l,t.className),null!=t.style&&Object.keys(t.style).forEach(e=>{l.style[e]=t.style[e]}),l}(n,e,l)),function(){let e=l.map.getPane(n);e?.remove?.(),null!=l.map._panes&&(l.map._panes=H(l.map._panes,n),l.map._paneRenderers=H(l.map._paneRenderers,n))}),[]),null!=e.children&&null!=r?(0,g.createPortal)(i.createElement(f,{value:u},e.children),r):null}),q=_(function({positions:e,...t},n){let r=new d.Polyline(e,t);return b(r,c(n,{overlayContainer:r}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),z=(r=E(function(e,t){return b(new d.Tooltip(e,t.overlayContainer),t)}),o=function(e,t,{position:n},r){(0,i.useEffect)(function(){let o=t.overlayContainer;if(null==o)return;let{instance:l}=e,u=e=>{e.tooltip===l&&(null!=n&&l.setLatLng(n),l.update(),r(!0))},a=e=>{e.tooltip===l&&r(!1)};return o.on({tooltipopen:u,tooltipclose:a}),o.bindTooltip(l),function(){o.off({tooltipopen:u,tooltipclose:a}),null!=o._map&&o.unbindTooltip()}},[e,t,r,n])},l=function(e,t){let n=p(),l=r(w(e,n),n);return x(n.map,e.attribution),j(l.current,e.eventHandlers),o(l.current,n,e,t),l},(0,i.forwardRef)(function(e,t){let[n,r]=(0,i.useState)(!1),{instance:o}=l(e,r).current;(0,i.useImperativeHandle)(t,()=>o),(0,i.useEffect)(function(){n&&o.update()},[o,n,e.children]);let u=o._contentNode;return u?(0,g.createPortal)(e.children,u):null})),I=_(function({center:e,children:t,...n},r){let o=new d.Circle(e,n);return b(o,c(r,{overlayContainer:o}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)});var A=n(10938),B=n.n(A);let{sqrt:Z}=Math;function U(e){let{id:t,count:n,selected:r,selectedStationId:o,setSelectedStationId:l,stations:a}=e;if(!(t in a))return console.log("id ".concat(t," not in stations")),null;let{name:i,lat:c,lng:s}=a[t];return(0,u.jsx)(I,{center:{lat:c,lng:s},color:r?"yellow":"orange",radius:Z(n),bubblingMouseEvents:!1,eventHandlers:{click:e=>{t!=o&&(console.log("click!",i,e),l(t))},mouseover:e=>{t!=o&&(console.log("over!",i,e),l(t))}},children:(0,u.jsx)(z,{className:B().tooltip,sticky:!0,permanent:t==o,pane:"selected",children:(0,u.jsxs)("p",{children:[i,": ",n]})})},t)}let{sqrt:F}=Math;function X(e){let{stations:t,selectedStationId:n,setSelectedStationId:r,stationPairCounts:o}=e,l=v(),c=l.getZoom(),s=(0,i.useMemo)(()=>(function(e){let t=e.getCenter(),n=e.latLngToContainerPoint(t),r=[n.x+1,n.y],o=e.containerPointToLatLng(n),l=e.containerPointToLatLng(r);return o.distanceTo(l)})(l),[l,c]),f=(0,i.useMemo)(()=>n?t[n]:void 0,[t,n]),p=(0,i.useMemo)(()=>{if(!f||!n||!o)return null;if(!(n in o))return console.log("".concat(n," not found among ").concat((0,a.XP)(o).length," stations")),null;let e=o[n],r=Math.max(...Array.from(Object.values(e)));return(0,u.jsx)(S,{name:"lines",className:B().lines,children:(0,a.qh)(e).map(e=>{let[o,l]=e;if(!(o in t)){console.log("id ".concat(o," not in stations:"),t);return}let{name:a,lat:i,lng:p}=t[o];return(0,u.jsx)(q,{color:"red",positions:[[f.lat,f.lng],[i,p]],weight:Math.max(.7,l/r*F(f.starts)/s),opacity:.7,children:(0,u.jsxs)(z,{sticky:!0,children:[f.name," â†’ ",a,": ",l]})},"".concat(n,"-").concat(o,"-").concat(c))})})},[o,n,s]),d={stations:t,selectedStationId:n,setSelectedStationId:r};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(S,{name:"selected",className:B().selected,children:n&&f&&(0,u.jsx)(U,{id:n,count:f.starts,selected:!0,...d},n)}),p,(0,u.jsx)(S,{name:"circles",className:B().circles,children:(0,a.qh)(t).map(e=>{let[t,n]=e;return(0,u.jsx)(U,{id:t,count:n.starts,...d},t)})})]})}function $(e){let{mapProps:t,bodyProps:n}=e;return(0,u.jsx)(T,{...t,children:(0,u.jsx)(X,{...n})})}},89136:function(e,t,n){function r(e,t){return u(e).map(([e,n],r)=>t(e,n,r))}n.d(t,{Q8:function(){return i},XP:function(){return l},_I:function(){return r},qh:function(){return u},sq:function(){return a},zo:function(){return o}});let o=e=>[].concat(...e);function l(e){return Object.keys(e)}function u(e){return Object.entries(e)}function a(e){return Object.fromEntries(e)}function i(e,t){var n;return n=(e,n)=>[e,t(e,n)],a(u(e).map(([e,t],r)=>n(e,t,r)))}}}]);